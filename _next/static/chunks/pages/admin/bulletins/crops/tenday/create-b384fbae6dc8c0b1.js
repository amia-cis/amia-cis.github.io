(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5507],{67947:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bulletins/crops/tenday/create",function(){return t(91617)}])},91617:function(e,n,t){"use strict";t.r(n);var r=t(34051),i=t.n(r),o=t(85893),u=t(67294),l=t(9473),c=t(30340),a=t(66383),s=t(95243),f=t(16327),p=t(61690),d=t(87006),v=t(24530),m=t(901),_=t(76490),g=t(33050),y=t(4463),b=t(68193),h=t(23766),E=t(41375),w=t(94640),S=t(16013),O=t(27392),N=t(59111),k=t(47426),A=t(53063),P=t(12671),D=t(87661),L=t(87784);function T(e,n,t,r,i,o,u){try{var l=e[o](u),c=l.value}catch(a){return void t(a)}l.done?n(c):Promise.resolve(c).then(r,i)}function x(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var o=e.apply(n,t);function u(e){T(o,r,i,u,l,"next",e)}function l(e){T(o,r,i,u,l,"throw",e)}u(void 0)}))}}function Y(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function j(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){Y(e,n,t[n])}))}return e}var C={sel_province:null,sel_municipality:null,sel_crop:null,sel_stage:null,sel_activity:[],sel_month:null,processed:!1,loading:!1,error:"",success:"",sel_condition:{id:0,from:"weather_condition",label:k.MW.WAY_BELOW_NORMAL.label}},R={url:"",filename:""};n.default=(0,s.Z)((function(e){var n=e.user,t=e.onBtnLogoutClick,r=e.loading,s=(0,u.useState)(C),T=s[0],B=s[1],I=(0,u.useState)([]),Z=I[0],F=I[1],W=(0,u.useState)([]),K=W[0],M=W[1],U=(0,u.useState)([]),q=U[0],G=U[1],X=(0,u.useState)([]),z=X[0],V=X[1],$=(0,u.useState)(null),H=$[0],J=$[1],Q=(0,h.Z)(T.sel_province,z),ee=(0,w.Z)(T.sel_province,T.sel_municipality),ne=ee.days,te=ee.loading,re=ee.error,ie=ee.summary,oe=(0,g.Z)(T.sel_province),ue=oe.cropcalendar,le=oe.loading,ce=oe.error,ae=(0,_.Z)(ue,T.sel_municipality),se=(0,y.Z)(Z,null===ie||void 0===ie?void 0:ie.date_start,ae,!0),fe=se.cropslist,pe=se.uniquecropstages,de=se.error,ve=(0,b.Z)(H,null,S.q.TENDAY,!0),me=ve.recommendations,_e=ve.farmoperations,ge=ve.loading,ye=ve.error,be=(0,E.Z)(me),he=be.group,Ee=be.error,we=(0,l.v9)((function(e){return e.reports})),Se=we.status,Oe=we.report,Ne=(0,l.v9)((function(e){return e.dashboard.reportType})),ke=(0,l.v9)((function(e){return e.dashboard.isEnglish})),Ae=(0,u.useState)(!0),Pe=Ae[0],De=Ae[1],Le=(0,u.useState)(!1),Te=Le[0],xe=Le[1],Ye=(0,u.useRef)(!1),je=(0,u.useState)(""),Ce=je[0],Re=je[1],Be=(0,u.useState)(R),Ie=Be[0],Ze=Be[1],Fe=(0,u.useState)(O.BF),We=Fe[0],Ke=Fe[1],Me=(0,l.I0)();(0,u.useEffect)((function(){Ye.current=!0;var e=function(){var e=x(i().mark((function e(){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,f.$m)();case 3:n=e.sent,Ye&&V(n.data),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return e(),function(){Ye.current=!1}}),[]),(0,u.useEffect)((function(){Me((0,v.Km)([])),Me((0,P.s_)())}),[Me]),(0,u.useEffect)((function(){z.length>0&&G((0,N.m)(z))}),[z]),(0,u.useEffect)((function(){null!==ie&&B((function(e){return j({},e,{sel_month:{label:ie.date_range}})}))}),[ie]),(0,u.useEffect)((function(){De(r||le||ge||te)}),[r,le,ge,te]),(0,u.useEffect)((function(){Ze(R)}),[ke]),(0,u.useEffect)((function(){if(""!==ce||""!==ye||""!==re||""!==de){var e=ce||ye||re||de;B((function(n){return j({},n,{error:e})}))}else B((function(e){return j({},e,{error:""})}))}),[de,ye,re,ce]),(0,u.useEffect)((function(){null===T.sel_municipality||te||Re((function(e){var n;return(0,D.smsWriter)({type:D.SMS_TYPE.TENDAY,replacements:(n={},Y(n,D.REPLACE_KEYS.TENDAY.MUNICIPALITY,T.sel_municipality),Y(n,D.REPLACE_KEYS.TENDAY.FORECAST,ne.reduce((function(e,n){return e+="".concat(n.label," - ").concat(n.rainfall,"\n")}),"")),n)})}))}),[ne,te,T.sel_municipality]),(0,u.useEffect)((function(){Se===m.G.FULLFILLED&&null!==Oe&&Ye.current&&Ke((function(e){return j({},e,{msg:"Success! Bulletin report created.",loading:!1,savesuccess:!0,docId:Oe.id})}))}),[Se,Oe]),(0,u.useEffect)((function(){Ee||null===he||Me((0,v.Km)(he))}),[he,Ee,Me]),(0,u.useEffect)((function(){if(!r&&""===T.error)if(pe.length>0){var e=pe.map((function(e){return e.code})).toString(),n=pe.map((function(e){return e.label})).toString();J(e),B((function(e){return j({},e,{sel_crop:fe.map((function(e){return e.label})).toString().split(",").join(", "),sel_stage:n})}))}else Me((0,v.Km)([])),null!==T.sel_municipality&&B((function(e){return j({},e,{error:"No crop stages are available for this date on ".concat(e.sel_municipality,".")})}))}),[pe,fe,r,,Me]);var Ue=function(){var e=x(i().mark((function e(){var n,t,r,o,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===Ie.url){e.next=3;break}return xe(!0),e.abrupt("return");case 3:return B((function(e){return j({},e,{loading:!0,error:"",success:""})})),e.prev=4,n={region:"bicol",province:T.sel_province,municipality:T.sel_municipality,operation:"preview",language:ke?"en":"tag"},xe(!0),B((function(e){return j({},e,{loading:!0,error:""})})),e.next=10,(0,d.bM)(n);case 10:t=e.sent,r=new Blob([t],{type:"application/pdf"}),(o={}).href=URL.createObjectURL(r),o.download="".concat(T.sel_province,"_").concat(T.sel_municipality,".pdf"),Ze((function(e){return j({},e,{url:o.href,filename:o.download})})),B((function(e){return j({},e,{loading:!1,success:"Bulletin preview created."})})),e.next=25;break;case 19:return e.prev=19,e.t0=e.catch(4),e.next=23,(0,L.fu)(e.t0);case 23:u=e.sent,B((function(e){return j({},e,{loading:!1,error:u})}));case 25:case"end":return e.stop()}}),e,null,[[4,19]])})));return function(){return e.apply(this,arguments)}}(),qe=function(){var e=x(i().mark((function e(){var t,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ke(j({},We,{loading:!0,msg:"Saving report..."}));try{t={region:"bicol",province:T.sel_province,municipality:T.sel_municipality,operation:"create",language:ke?"en":"tag"},Me((0,p.a0)(t)).unwrap().then((function(){Ne!==O.Ry.TEN_DAY&&(Me((0,A.uq)(O.Ry.TEN_DAY)),Me((0,p.RC)({uid:n.uid,type:O.Ry.TEN_DAY})))})).catch((function(e){Ye.current&&Ke((function(n){return j({},n,{msg:e,loading:!1,savesuccess:!1,docId:null})}))}))}catch(o){r="",void 0!==o.response&&(r=void 0!==o.response.data&&"[object Blob]"===((i=o.response.data)&&"undefined"!==typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)?o.response.data:""),""===r&&(r=o.message),B((function(e){return j({},e,{loading:!1,error:r})}))}case 2:case"end":return e.stop()}var i}),e)})));return function(){return e.apply(this,arguments)}}();return(0,o.jsx)(a.Z,{loading:r,user:n,onBtnLogoutClick:t,accLevel:k.DW.ADMIN,children:(0,o.jsx)(c.Z,{optsprovinces:q,optsmunicipalities:Q,optscrops:fe,optscropstages:pe,optsactivities:_e,sel_options:T,loading:Pe,isloadingreport:Se===m.G.PENDING,isdisabled:!1,open:Te,message:We,smstext:Ce,pageTitle:"10-Day Farm Weather Outlook and Advisory Bulletin",pageDescription:"Create <strong>10-Day Farm Weather Outlook and Advisory</strong> crop recommendations bulletins. Finalized bulletins will be automatically uploaded to the site for public download.",pdfPreview:Ie,onSelectItemChange:function(e,n){var t=n.from,r=n.label;if(Ze(R),K.length>0&&M([]),""!==T.error&&B((function(e){return j({},e,{error:""})})),Object.keys(n).includes("id"))switch(t){case"province":J(null),B((function(e){return j({},e,{sel_province:r,sel_municipality:null,sel_crop:null,sel_stage:null,sel_activity:null})}));break;case"municipality":J(null),B((function(e){return j({},e,{sel_municipality:r,sel_crop:null,sel_stage:null,sel_activity:null})})),F(ue.filter((function(e){return e.municipality===r})))}else if("province"===t){var i=T.sel_month;B(j({},C,{sel_month:i})),J(null)}else"municipality"===t&&(B(j({},T,{sel_municipality:null,sel_crop:null,sel_day:null,sel_stage:null,sel_activity:null})),J(null))},handlePreview:Ue,handleSave:qe,toggleViewerOpen:function(){xe((function(e){return!e}))},resetSelections:function(){var e=T.sel_month;B(j({},C,{sel_month:e})),J(null),Me((0,v.Km)([]))},togglePrompt:function(){Ke((function(e){return j({},O.BF,{isOpen:!e.isOpen})}))}})})}))},59111:function(e,n,t){"use strict";t.d(n,{m:function(){return r}});var r=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label";return e.map((function(e,t){return{id:t,label:e[n]}}))}}},function(e){e.O(0,[6284,2866,9964,9522,1903,6279,6295,4039,2882,7092,6572,1050,2944,7702,1241,9774,2888,179],(function(){return n=67947,e(e.s=n);var n}));var n=e.O();_N_E=n}]);