(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5507],{67947:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bulletins/crops/tenday/create",function(){return t(91617)}])},91617:function(e,n,t){"use strict";t.r(n),t.d(n,{__N_SSG:function(){return R}});var r=t(34051),i=t.n(r),o=t(85893),u=t(67294),l=t(9473),c=t(30340),a=t(66383),s=t(95243),f=t(61690),p=t(87006),d=t(24530),v=t(901),m=t(76490),_=t(33050),g=t(4463),y=t(68193),b=t(23766),h=t(41375),E=t(94640),w=t(16013),S=t(27392),O=t(59111),N=t(47426),A=t(53063),P=t(12671),k=t(87661);function D(e,n,t,r,i,o,u){try{var l=e[o](u),c=l.value}catch(a){return void t(a)}l.done?n(c):Promise.resolve(c).then(r,i)}function L(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var o=e.apply(n,t);function u(e){D(o,r,i,u,l,"next",e)}function l(e){D(o,r,i,u,l,"throw",e)}u(void 0)}))}}function T(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function j(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){T(e,n,t[n])}))}return e}var Y=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},B={sel_province:null,sel_municipality:null,sel_crop:null,sel_stage:null,sel_activity:[],sel_month:null,processed:!1,loading:!1,error:"",success:"",sel_condition:{id:0,from:"weather_condition",label:N.MW.WAY_BELOW_NORMAL.label}},C={url:"",filename:""};var R=!0;n.default=(0,s.Z)((function(e){var n=e.provinces,t=void 0===n?[]:n,r=e.user,s=e.onBtnLogoutClick,D=e.loading,R=(0,u.useState)(B),I=R[0],Z=R[1],x=(0,u.useState)([]),F=x[0],W=x[1],K=(0,u.useState)([]),M=K[0],G=K[1],U=(0,u.useState)([]),q=U[0],X=U[1],z=(0,u.useState)(null),V=z[0],H=z[1],J=(0,b.Z)(I.sel_province,t),Q=(0,E.Z)(I.sel_province,I.sel_municipality),$=Q.days,ee=Q.loading,ne=Q.error,te=Q.summary,re=(0,_.Z)(I.sel_province),ie=re.cropcalendar,oe=re.loading,ue=re.error,le=(0,m.Z)(ie,I.sel_municipality),ce=(0,g.Z)(F,null===te||void 0===te?void 0:te.date_start,le,!0),ae=ce.cropslist,se=ce.uniquecropstages,fe=ce.error,pe=(0,y.Z)(V,null,w.q.TENDAY,!0),de=pe.recommendations,ve=pe.farmoperations,me=pe.loading,_e=pe.error,ge=(0,h.Z)(de),ye=ge.group,be=ge.error,he=(0,l.v9)((function(e){return e.reports})),Ee=he.status,we=he.report,Se=(0,l.v9)((function(e){return e.dashboard.reportType})),Oe=(0,l.v9)((function(e){return e.dashboard.isEnglish})),Ne=(0,u.useState)(!0),Ae=Ne[0],Pe=Ne[1],ke=(0,u.useState)(!1),De=ke[0],Le=ke[1],Te=(0,u.useRef)(!1),je=(0,u.useState)(""),Ye=je[0],Be=je[1],Ce=(0,u.useState)(C),Re=Ce[0],Ie=Ce[1],Ze=(0,u.useState)(S.BF),xe=Ze[0],Fe=Ze[1],We=(0,l.I0)();(0,u.useEffect)((function(){return Te.current=!0,function(){Te.current=!1}}),[]),(0,u.useEffect)((function(){We((0,d.Km)([])),We((0,P.s_)())}),[We]),(0,u.useEffect)((function(){t.length>0&&X((0,O.m)(t))}),[t]),(0,u.useEffect)((function(){null!==te&&Z((function(e){return j({},e,{sel_month:{label:te.date_range}})}))}),[te]),(0,u.useEffect)((function(){Pe(D||oe||me||ee)}),[D,oe,me,ee]),(0,u.useEffect)((function(){Ie(C)}),[Oe]),(0,u.useEffect)((function(){if(""!==ue||""!==_e||""!==ne||""!==fe){var e=ue||_e||ne||fe;Z((function(n){return j({},n,{error:e})}))}else Z((function(e){return j({},e,{error:""})}))}),[fe,_e,ne,ue]),(0,u.useEffect)((function(){null===I.sel_municipality||ee||Be((function(e){var n;return(0,k.smsWriter)({type:k.SMS_TYPE.TENDAY,replacements:(n={},T(n,k.REPLACE_KEYS.TENDAY.MUNICIPALITY,I.sel_municipality),T(n,k.REPLACE_KEYS.TENDAY.FORECAST,$.reduce((function(e,n){return e+="".concat(n.label," - ").concat(n.rainfall,"\n")}),"")),n)})}))}),[$,ee,I.sel_municipality]),(0,u.useEffect)((function(){Ee===v.G.FULLFILLED&&null!==we&&Te.current&&Fe((function(e){return j({},e,{msg:"Success! Bulletin report created.",loading:!1,savesuccess:!0,docId:we.id})}))}),[Ee,we]),(0,u.useEffect)((function(){be||null===ye||We((0,d.Km)(ye))}),[ye,be,We]),(0,u.useEffect)((function(){if(!D)if(se.length>0){var e=se.map((function(e){return e.code})).toString(),n=se.map((function(e){return e.label})).toString();H(e),Z((function(e){return j({},e,{sel_crop:ae.map((function(e){return e.label})).toString().split(",").join(", "),sel_stage:n})}))}else We((0,d.Km)([])),null!==I.sel_municipality&&Z((function(e){return j({},e,{error:"No crop stages are available for this date on ".concat(e.sel_municipality,".")})}))}),[se,ae,D,,We]);var Ke=function(){var e=L(i().mark((function e(){var n,t,r,o,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===Re.url){e.next=3;break}return Le(!0),e.abrupt("return");case 3:return Z((function(e){return j({},e,{loading:!0,error:"",success:""})})),e.prev=4,n={region:"bicol",province:I.sel_province,municipality:I.sel_municipality,operation:"preview",language:Oe?"en":"tag"},Le(!0),Z((function(e){return j({},e,{loading:!0,error:""})})),e.next=10,(0,p.bM)(n);case 10:t=e.sent,r=new Blob([t],{type:"application/pdf"}),(o={}).href=URL.createObjectURL(r),o.download="".concat(I.sel_province,"_").concat(I.sel_municipality,".pdf"),Ie((function(e){return j({},e,{url:o.href,filename:o.download})})),Z((function(e){return j({},e,{loading:!1,success:"Bulletin preview created."})})),e.next=25;break;case 19:e.prev=19,e.t0=e.catch(4),u="",void 0!==e.t0.response&&(u=void 0!==e.t0.response.data&&"[object Blob]"===Y(e.t0.response.data)?e.t0.response.data:""),""===u&&(u=e.t0.message),Z((function(e){return j({},e,{loading:!1,error:u})}));case 25:case"end":return e.stop()}}),e,null,[[4,19]])})));return function(){return e.apply(this,arguments)}}(),Me=function(){var e=L(i().mark((function e(){var n,t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Fe(j({},xe,{loading:!0,msg:"Saving report..."}));try{n={region:"bicol",province:I.sel_province,municipality:I.sel_municipality,operation:"create",language:Oe?"en":"tag"},We((0,f.a0)(n)).unwrap().then((function(){Se!==S.Ry.TEN_DAY&&(We((0,A.uq)(S.Ry.TEN_DAY)),We((0,f.RC)({uid:r.uid,type:S.Ry.TEN_DAY})))})).catch((function(e){Te.current&&Fe((function(n){return j({},n,{msg:e,loading:!1,savesuccess:!1,docId:null})}))}))}catch(i){t="",void 0!==i.response&&(t=void 0!==i.response.data&&"[object Blob]"===Y(i.response.data)?i.response.data:""),""===t&&(t=i.message),Z((function(e){return j({},e,{loading:!1,error:t})}))}case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,o.jsx)(a.Z,{loading:D,user:r,onBtnLogoutClick:s,accLevel:N.DW.ADMIN,children:(0,o.jsx)(c.Z,{optsprovinces:q,optsmunicipalities:J,optscrops:ae,optscropstages:se,optsactivities:ve,sel_options:I,loading:Ae,isloadingreport:Ee===v.G.PENDING,isdisabled:!1,open:De,message:xe,smstext:Ye,pageTitle:"10-Day Farm Weather Outlook and Advisory Bulletin",pageDescription:"Create <strong>10-Day Farm Weather Outlook and Advisory</strong> crop recommendations bulletins. Finalized bulletins will be automatically uploaded to the site for public download.",pdfPreview:Re,onSelectItemChange:function(e,n){var t=n.from,r=n.label;if(Ie(C),M.length>0&&G([]),""!==I.error&&Z((function(e){return j({},e,{error:""})})),Object.keys(n).includes("id"))switch(t){case"province":H(null),Z((function(e){return j({},e,{sel_province:r,sel_municipality:null,sel_crop:null,sel_stage:null,sel_activity:null})}));break;case"municipality":H(null),Z((function(e){return j({},e,{sel_municipality:r,sel_crop:null,sel_stage:null,sel_activity:null})})),W(ie.filter((function(e){return e.municipality===r})))}else if("province"===t){var i=I.sel_month;Z(j({},B,{sel_month:i})),H(null)}else"municipality"===t&&(Z(j({},I,{sel_municipality:null,sel_crop:null,sel_day:null,sel_stage:null,sel_activity:null})),H(null))},handlePreview:Ke,handleSave:Me,toggleViewerOpen:function(){Le((function(e){return!e}))},resetSelections:function(){var e=I.sel_month;Z(j({},B,{sel_month:e})),H(null),We((0,d.Km)([]))},togglePrompt:function(){Fe((function(e){return j({},S.BF,{isOpen:!e.isOpen})}))}})})}))},59111:function(e,n,t){"use strict";t.d(n,{m:function(){return r}});var r=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label";return e.map((function(e,t){return{id:t,label:e[n]}}))}}},function(e){e.O(0,[6284,2866,9964,9522,1903,6279,6295,4039,2882,7092,6572,1050,3523,7702,1241,9774,2888,179],(function(){return n=67947,e(e.s=n);var n}));var n=e.O();_N_E=n}]);