(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3755],{5326:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bulletins/crops/create",function(){return t(9919)}])},7513:function(e,n){"use strict";n.Z={container:{padding:"24px",width:"100%",position:"relative",minWidth:"0px",overflowWrap:"break-word",background:"#FFFFFF",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px",borderRadius:"16px",margin:"auto",borderColor:"#E2E8F0"},welcome:{display:"grid",placeContent:"center",marginTop:function(e){return e.spacing(10)},textAlign:"center","& h5":{marginTop:function(e){return e.spacing(2)}}},conditionLegend:{maxWidth:{md:"100%",lg:"270px"},marginBottom:"32px",padding:function(e){return e.spacing(1)},borderRadius:"4px",border:"1px solid grey",textAlign:"center",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px"},autocomplete:{marginTop:function(e){return e.spacing(1)}},recSeasonal:{marginTop:function(e){return e.spacing(1)},"& p, ul":{fontSize:"14px"}},gridContainer:{marginTop:"24px",minHeight:500,width:1,"& .normal":{backgroundColor:"yellow"},"& .drier":{backgroundColor:"red"},"& .wetter":{backgroundColor:"blue"}},button:{color:"#FFFFFF",textTransform:"capitalize",fontSize:"14px",fontStyle:"normal",fontWeight:"normal",width:"80px",height:{xs:"40px",sm:"50px"}},pdfcontent:{ul:{paddingLeft:3}}}},3080:function(e,n,t){"use strict";var i=t(5893),r=t(7357),l=t(8456);n.Z=function(e){var n=e.text,t=void 0===n?"":n,a=e.size,o=void 0===a?24:a,c=e.children;return(0,i.jsxs)(r.Z,{sx:{width:"100%",textAlign:"center",height:"20vh"},children:[(0,i.jsxs)(r.Z,{sx:{width:"100%",textAlign:"center",marginTop:function(e){return e.spacing(12)},marginBottom:"32px",display:"flex",justifyContent:"center"},children:[(0,i.jsx)("span",{children:""!==t?t:"Loading..."})," \xa0",(0,i.jsx)(l.Z,{size:o})]}),c]})}},9919:function(e,n,t){"use strict";t.r(n),t.d(n,{__N_SSG:function(){return he},default:function(){return me}});var i=t(4051),r=t.n(i),l=t(5893),a=t(7294),o=t(2848),c=t(1652),s=t(560),u=t(4680),d=t(8152),p=t(7682),f=t(7426),b=[{label:"Select a province",description:"Select a province within the Bicol region.",opt_name:"sel_province"},{label:"Select a municipality",description:"Select a municipality included in the province you have selected on step no. 1.",opt_name:"sel_municipality"},{label:"Select a crop type",description:"Listed below are available crops for your selected province and municipality.",opt_name:"sel_crop"},{label:"Select a month",description:"Select a target month from the current Seasonal Weather Forecast.",opt_name:"sel_month"},{label:"Select crop stages",description:"Listed below are the available crop stages for your selected crop on the target month.",opt_name:"sel_stage"},{label:"Select activities",description:"Here are available activities for the previously-selected parameters.",opt_name:"sel_activity"}],h=t(3059),m=t(1163),v=t(5697),g=t.n(v),x=t(1664),y=t(5675),_=t(6295),j=t(7357),Z=t(9368),S=t(8456),w=t(1057),C=t(6863),O=t(657),k=t(1425),R=t(6580),E=t(8951),P=t(7645),T=t(7720),I=t(6886),A=t(5113),F=t(6624),B=t(710),M=t(3578),W=t(6229),L=t(1903),N=t(5861),D=t(8409),z=t(44),U=t(120),q=t(1033),V=t(3080),H=t(2172),J=t(9794),K=t(9628),$=t(7171),X=t(7513);function G(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Q(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},i=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),i.forEach((function(n){G(e,n,t[n])}))}return e}function Y(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},l=Object.keys(e);for(i=0;i<l.length;i++)t=l[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(i=0;i<l.length;i++)t=l[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var ee=["sel_province","sel_municipality","sel_crop","sel_month","sel_stage","sel_activity"];var ne=function(e){var n=function(e){var n=e.children,t=e.value,i=e.index,r=Y(e,["children","value","index"]);return(0,l.jsx)("div",Q({role:"tabpanel",hidden:t!==i,id:"simple-tabpanel-".concat(i),"aria-labelledby":"simple-tab-".concat(i)},r,{children:t===i&&(0,l.jsx)(j.Z,{sx:{p:3},children:n})}))},t=function(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}},i=(0,a.useState)(0),r=i[0],o=i[1],c=(0,a.useRef)(!0),s=(0,m.useRouter)(),u=(0,a.useState)(!0),d=u[0],p=u[1],b=(0,a.useState)(0),h=b[0],v=b[1],G=e.sel_options,ne=e.provinces,te=e.recommendations,ie=e.onSelectItemChange,re=e.optsmunicipalities,le=e.optscrops,ae=e.optscropstages,oe=e.optsactivities,ce=e.optsmonths,se=e.open,ue=e.pdfPreview,de=e.steps,pe=e.getStepLabel,fe=e.isContinueDisabled,be=e.handleSave,he=e.handlePreview,me=e.toggleViewerOpen,ve=(0,l.jsx)(K.Z,{fontSize:"small"}),ge=(0,l.jsx)($.Z,{fontSize:"small"});(0,a.useEffect)((function(){return c.current=!0,function(){c.current=!1}}),[]);var xe=function(){p(!1),setTimeout((function(){(c.current=!0)&&p(!0)}),500),o((function(e){return e+1}))},ye=function(){o((function(e){return e-1}))},_e=function(){var e="Loading...";return ne.length>0&&(e=null===G.sel_province?"Select a province":"Province"),e};return n.propTypes={children:g().node,index:g().number.isRequired,value:g().number.isRequired},(0,l.jsxs)("div",{children:[(0,l.jsxs)(O.Z,{open:se.savesuccess,"aria-labelledby":"data-saved-success","aria-describedby":"alert-dialog-description",children:[(0,l.jsx)(P.Z,{id:"data-saved-success",children:"Success"}),(0,l.jsx)(R.Z,{children:(0,l.jsx)(E.Z,{id:"alert-dialog-description",children:"Success! Bulletin report created."})}),(0,l.jsx)(k.Z,{children:(0,l.jsx)(w.Z,{onClick:function(){s.push("/admin/bulletins/crops/view/?docId=".concat(se.docId))},autoFocus:!0,children:"OK"})})]}),(0,l.jsxs)(O.Z,{open:se.preview,maxWidth:"lg",fullWidth:!0,"aria-labelledby":"data-saved-success","aria-describedby":"alert-dialog-description",children:[(0,l.jsx)(P.Z,{id:"data-saved-success",children:""!==ue.filename?"Bulletin Preview - ".concat(ue.filename):"Bulletin Preview"}),(0,l.jsx)(R.Z,{sx:{padding:0,overflow:"hidden"},children:(0,l.jsx)(j.Z,{id:"alert-dialog-description",children:G.loading?(0,l.jsx)("div",{style:{width:"100%",height:"90vh",textAlign:"center"},children:(0,l.jsx)(V.Z,{text:"Loading Preview...",children:(0,l.jsx)(y.default,{unoptimized:!0,src:(0,U.assetPrefixer)("images/icons/data-processing-128.png"),height:100,width:100,loader:U.imageLoader,alt:"Loading Preview"})})}):""!==G.error?(0,l.jsx)("div",{style:{width:"100%",height:"100vh"},children:(0,l.jsx)(q.Z,{message:G.error})}):(0,l.jsx)("embed",{src:ue.url,style:{width:"100%",height:"70vh"}})})}),(0,l.jsx)(k.Z,{children:(0,l.jsx)(w.Z,{variant:"contained",onClick:me,autoFocus:!0,children:"OK"})})]}),(0,l.jsxs)(I.ZP,{container:!0,sx:X.Z.container,children:[(0,l.jsxs)(j.Z,{sx:{marginBottom:"32px"},children:[(0,l.jsx)(N.Z,{variant:"h5",children:"Create Crop Recommendations Bulletins"}),(0,l.jsxs)("p",{children:["Create ",(0,l.jsx)("strong",{children:"Seasonal"})," crop recommendations bulletins. Finalized bulletins will be automatically uploaded to the site for public download."]})]}),(0,l.jsxs)(I.ZP,{item:!0,sx:X.Z.item,xs:12,lg:4,children:[(0,l.jsxs)(j.Z,{sx:{minWidth:"100%",paddingRight:function(e){return e.spacing(2)}},children:[(0,l.jsx)(N.Z,{variant:"h6",children:"Selection Options"}),(0,l.jsx)(F.Z,{activeStep:r,orientation:"vertical",children:de.map((function(e,n){return(0,l.jsxs)(B.Z,{children:[(0,l.jsx)(M.Z,{optional:5===n?(0,l.jsx)(N.Z,{variant:"caption",children:"Last step"}):null,children:pe(n)}),(0,l.jsxs)(W.Z,{children:[(0,l.jsx)(N.Z,{variant:"subtitle",children:e.description}),0===n&&(0,l.jsx)(_.Z,{disablePortal:!0,id:"province",value:G.sel_province,disabled:0===ne.length,options:ne,sx:X.Z.autocomplete,PaperComponent:H.Z,renderInput:function(e){return(0,l.jsx)(L.Z,Q({},e,{label:_e()}))},isOptionEqualToValue:function(e,n){return e.label===n.label},onChange:function(e,n){return ie(e,Q({},n,{from:"province"}))}}),1===n&&(0,l.jsx)(_.Z,{disablePortal:!0,id:"municipality",value:G.sel_municipality,disabled:0===re.length||G.loading,options:re,sx:X.Z.autocomplete,PaperComponent:H.Z,renderInput:function(e){return(0,l.jsx)(L.Z,Q({},e,{label:null===G.sel_municipality?"Select a municipality":"Municipality"}))},isOptionEqualToValue:function(e,n){return e.label===n.label},onChange:function(e,n){return ie(e,Q({},n,{from:"municipality"}))}}),2===n&&(0,l.jsx)(_.Z,{disablePortal:!0,id:"crop",value:G.sel_crop,disabled:0===le.length,options:le,sx:X.Z.autocomplete,PaperComponent:H.Z,renderInput:function(e){return(0,l.jsx)(L.Z,Q({},e,{label:null===G.sel_crop?"Select a crop type":"Crop"}))},isOptionEqualToValue:function(e,n){return e.label===n.label},getOptionDisabled:function(e){return e.disabled},onChange:function(e,n){return ie(e,Q({},n,{from:"crop"}))}}),3===n&&(0,l.jsx)(_.Z,{disablePortal:!0,id:"month",value:G.sel_month,disabled:0===ce.length||null===G.sel_crop,options:ce,sx:X.Z.autocomplete,PaperComponent:H.Z,renderInput:function(e){return(0,l.jsx)(L.Z,Q({},e,{label:null===G.sel_month?"Select a Month":"Month"}))},isOptionEqualToValue:function(e,n){return e.label===n.label},getOptionDisabled:function(e){return e.disabled},onChange:function(e,n){return ie(e,Q({},n,{from:"month"}))}}),4===n&&(0,l.jsx)(_.Z,{disablePortal:!0,id:"cropstage",multiple:!0,disableCloseOnSelect:!0,limitTags:1,value:G.sel_stage,disabled:0===ae.length,options:ae,sx:X.Z.autocomplete,PaperComponent:H.Z,renderInput:function(e){return(0,l.jsx)(L.Z,Q({},e,{label:0===G.sel_stage.length?"Select crop stages":"Crop Stages"}))},getOptionDisabled:function(e){return e.disabled},onChange:function(e,n){return ie(e,Q({},n,{from:"cropstage"}))},renderOption:function(e,n,t){var i=t.selected;return(0,l.jsxs)("li",Q({},e,{children:[(0,l.jsx)(Z.Z,{id:"cropstage",icon:ve,checkedIcon:ge,style:{marginRight:8},checked:i}),n.label]}))}}),5===n&&(0,l.jsx)(_.Z,{disablePortal:!0,id:"activity",multiple:!0,disableCloseOnSelect:!0,limitTags:1,value:G.sel_activity,disabled:0===oe.length,options:oe.sort((function(e,n){return n.stage.localeCompare(e.stage)})),groupBy:function(e){return e.stage},sx:X.Z.autocomplete,PaperComponent:H.Z,renderInput:function(e){return(0,l.jsx)(L.Z,Q({},e,{label:0===G.sel_activity.length?"Select activities":"Activities"}))},getOptionDisabled:function(e){return e.disabled},onChange:function(e,n){return ie(e,Q({},n,{from:"activity"}))},renderOption:function(e,n,t){var i=t.selected;return(0,l.jsxs)("li",Q({},e,{children:[(0,l.jsx)(Z.Z,{id:"activity",icon:ve,checkedIcon:ge,style:{marginRight:8},checked:i}),n.label]}))}}),""!==G.error&&(0,l.jsx)(N.Z,{variant:"caption",sx:{color:"red"},children:G.error}),(0,l.jsx)(j.Z,{sx:{mb:2,marginTop:"24px"},children:(0,l.jsxs)("div",{children:[(0,l.jsx)(w.Z,{variant:"contained",disabled:fe(n)||G.loading||!d,onClick:xe,children:n===de.length-1?"Finish":"Continue"}),(0,l.jsx)(w.Z,{disabled:G.loading||!d||0===n,onClick:ye,children:"Back"})]})})]})]},e.label)}))}),r===de.length&&(0,l.jsxs)(A.Z,{square:!0,elevation:0,sx:{p:3},children:[(0,l.jsx)(N.Z,{children:"All steps completed"}),(0,l.jsx)(w.Z,{onClick:function(){o(0),ie(null,{from:"province"})},sx:{mt:1,mr:1},children:"Restart"}),(0,l.jsx)(w.Z,{onClick:ye,sx:{mt:1,mr:1},children:"Back"})]})]}),null!==G.sel_month&&(0,l.jsxs)(j.Z,{sx:X.Z.conditionLegend,style:{color:[f.MW.WETTER.label,f.MW.DRIER.label].includes(G.sel_condition.label)?"#fff":"#000",backgroundColor:f.tN[G.sel_condition.label]},children:[(0,l.jsx)(N.Z,{variant:"subtitle2",children:"Seasonal Weather Condition"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{children:G.sel_month.label})," \xa0",(0,l.jsxs)("span",{children:["".concat(G.sel_condition.label.charAt(0).toUpperCase()).concat(G.sel_condition.label.slice(1))," ","(",G.sel_condition.id,"%)"]})]})]})]}),(0,l.jsx)(I.ZP,{item:!0,sx:X.Z.item,xs:12,lg:8,children:null!==G.sel_crop&&null!==G.sel_activity&&6===r?(0,l.jsxs)("div",{children:[null!==G.sel_crop&&null!==G.sel_activity&&(0,l.jsxs)("div",{children:[(0,l.jsxs)(N.Z,{variant:"h4",sx:{display:0===G.sel_activity.length?"none":"flex"},children:[G.sel_crop.label," Recommendations"]}),(0,l.jsx)(N.Z,{variant:"h5",children:"".concat(G.sel_condition.label.charAt(0).toUpperCase()).concat(G.sel_condition.label.slice(1)," Condition")})]}),(0,l.jsxs)(j.Z,{sx:{width:"100%"},children:[(0,l.jsx)(j.Z,{sx:{borderBottom:1,borderColor:"divider"},children:(0,l.jsxs)(D.Z,{value:h,onChange:function(e,n){v(n)},"aria-label":"basic tabs example",children:[(0,l.jsx)(z.Z,Q({label:"PDF FORM"},t(0))),(0,l.jsx)(z.Z,Q({label:"SMS FORM"},t(1)))]})}),(0,l.jsx)(n,{value:h,index:0,children:te.length>0?te.map((function(e,n){var t="Rice"===G.sel_crop.label?"(".concat(e.crop,")"):"";return(0,l.jsxs)(j.Z,{sx:X.Z.recSeasonal,children:[(0,l.jsxs)(N.Z,{variant:"h5",children:[e.stage," - ",e.activity," ",t]}),e.recommendations().map((function(e,t){return e.ul?(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:e.id}),e.subs.length>0&&(0,l.jsx)("ul",{children:e.subs.map((function(e,t){return(0,l.jsx)("li",{children:e},"sub-".concat(n,"-").concat(t))}))})]},"main-".concat(n,"-").concat(t)):(0,l.jsx)("p",{children:e.id},"main-".concat(n,"-").concat(t))}))]},"rec-".concat(n))})):(0,l.jsx)(q.Z,{message:"We cannot find recommendations for your selected options."})}),(0,l.jsxs)(n,{value:h,index:1,children:[te.length>0?te.reduce((function(e,n){return e+=n.smsRecommendations()+" "}),""):(0,l.jsx)(q.Z,{message:"We cannot find SMS recommendations for your selected options."}),(0,l.jsx)("div",{})]})]})]}):Object.values(G).filter((function(e){return e})).length>3?(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center"},children:ee.map((function(e,n){var t=["sel_stage","sel_activity"].includes(e)?G[e].length>0&&"weather_condition"!==G[e].from:null!==G[e]&&void 0!==G[e]&&void 0!==G[e].from&&"weather_condition"!==G[e].from,i=["sel_stage","sel_activity"].includes(e)?{from:{sel_stage:"cropstage",sel_activity:"activity"}[e],label:G[e].map((function(e){return e.label})).toString().split(",").join(", ")}:G[e];return t?(0,l.jsx)(J.Z,{info:i,show:n<ee.length-1},"card-opt-".concat(n)):(0,l.jsx)("div",{},"card-opt-".concat(n))}))}):(0,l.jsxs)(j.Z,{sx:X.Z.welcome,children:[(0,l.jsx)(y.default,{unoptimized:!0,src:(0,U.assetPrefixer)("images/icons/finance.svg"),height:120,width:120,loader:U.imageLoader,alt:"Empty data"}),(0,l.jsx)(N.Z,{variant:"h5",children:"Crop Recommendations PDF Bulletins Creator"}),(0,l.jsx)(N.Z,{variant:"p",children:"Please select a province to start."})]})}),(0,l.jsxs)(j.Z,{sx:{marginBottom:"16px",width:"100%",display:6===r?"block":"none"},children:[(0,l.jsx)("br",{}),(0,l.jsx)(T.Z,{}),(0,l.jsx)("br",{}),""!==G.error&&(0,l.jsxs)(N.Z,{variant:"caption",sx:{color:"red"},children:["Error: ",G.error]}),(0,l.jsxs)(C.Z,{size:"large","aria-label":"large button group",sx:{display:"flex",justifyContent:"flex-end",marginTop:"8px"},children:[(0,l.jsx)(x.default,{href:"/admin/bulletins/crops",passHref:!0,children:(0,l.jsx)(w.Z,{disabled:G.loading,children:"Cancel"})}),(0,l.jsxs)(w.Z,{disabled:G.loading,onClick:he,children:[(0,l.jsx)("span",{style:{display:G.loading?"none":"block"},children:"Preview"})," ","\xa0",(0,l.jsx)(S.Z,{size:20,color:"secondary",sx:{display:G.loading?"block":"none"}})]}),(0,l.jsx)(w.Z,{variant:"contained",onClick:be,disableElevation:!0,disabled:G.loading,children:"Save"})]})]})]})]})},te=t(2530);function ie(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}function re(e,n,t,i,r,l,a){try{var o=e[l](a),c=o.value}catch(s){return void t(s)}o.done?n(c):Promise.resolve(c).then(i,r)}function le(e){return function(){var n=this,t=arguments;return new Promise((function(i,r){var l=e.apply(n,t);function a(e){re(l,i,r,a,o,"next",e)}function o(e){re(l,i,r,a,o,"throw",e)}a(void 0)}))}}function ae(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function oe(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},i=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),i.forEach((function(n){ae(e,n,t[n])}))}return e}function ce(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var i,r,l=[],a=!0,o=!1;try{for(t=t.call(e);!(a=(i=t.next()).done)&&(l.push(i.value),!n||l.length!==n);a=!0);}catch(c){o=!0,r=c}finally{try{a||null==t.return||t.return()}finally{if(o)throw r}}return l}}(e,n)||de(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function se(e){return function(e){if(Array.isArray(e))return ie(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||de(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ue=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function de(e,n){if(e){if("string"===typeof e)return ie(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?ie(e,n):void 0}}var pe={sel_province:null,sel_municipality:null,sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null,sel_condition:{id:0,from:"weather_condition",label:f.MW.DRIER.label},loading:!1,error:"",success:""},fe={url:"",filename:""},be={preview:!1,savesuccess:!1,docId:""};var he=!0,me=(0,h.Z)((function(e){var n=ce((0,p.ky)(u.o.STATIC_RECOMMENDATIONS,"data"),2),t=n[0],i=n[1],h=(0,p.m$)(s.M.WEATHER_FORECASTS,"bicol",s.M.SUB_SEASONAL,"name"),m=h.documents,v=h.loading,g=(0,a.useState)([]),x=g[0],y=g[1],_=(0,a.useState)([]),j=_[0],Z=_[1],S=(0,a.useState)([]),w=S[0],C=S[1],O=(0,a.useState)([]),k=O[0],R=O[1],E=(0,a.useState)([]),P=E[0],T=E[1],I=(0,a.useState)({}),A=I[0],F=I[1],B=(0,a.useState)(pe),M=B[0],W=B[1],L=(0,a.useState)([]),N=L[0],D=L[1],z=(0,a.useState)([]),U=z[0],q=z[1],V=(0,a.useState)([]),H=V[0],J=V[1],K=(0,a.useState)([]),$=K[0],X=K[1],G=(0,a.useState)(fe),Q=G[0],Y=G[1],ee=(0,a.useState)([]),ie=ee[0],re=ee[1],ae=(0,a.useState)(be),de=ae[0],he=ae[1],me=(0,a.useRef)(!1);(0,a.useEffect)((function(){return me.current=!0,function(){me.current=!1}}),[]),(0,a.useEffect)((function(){if(e.municipalities.length>0&&!v&&!i){var n={};m.forEach((function(e){var t=e.name.split("_").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join(" ");n[t]={},e.months.forEach((function(e){n[t][e.mo]={label:e.con,val:e.val}}))}));var t=[];m[0].mos.forEach((function(e){t.push({id:f.re[e.toUpperCase()].code,label:f.re[e.toUpperCase()].format,disabled:!1})}));var r={},l=[];e.municipalities.forEach((function(e,n){void 0===r[e.province]?(l.push({id:n,label:e.province}),r[e.province]=[{id:0,label:e.name}]):r[e.province].push({id:r[e.province].length,label:e.name})})),me.current&&(Z(r),y(l),re(t),F(n))}}),[e.municipalities,m,v,i]);var ve=function(){var e=le(r().mark((function e(n,i){var l,a,s,u,d,p,b,h,m,v,g,x,y,_,Z,S,O,E,P,I,F,B,L,N,z;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=i.from,a=i.label,n&&n.preventDefault(),T([]),Y(fe),!(["cropstage","activity"].includes(l)?Object.keys(i).length>1:Object.keys(i).includes("id"))){e.next=93;break}e.t0=l,e.next="province"===e.t0?9:"municipality"===e.t0?15:"crop"===e.t0?48:"month"===e.t0?57:"cropstage"===e.t0?67:"activity"===e.t0?77:90;break;case 9:return W(oe({},M,{sel_province:i,sel_municipality:null,sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null})),D(j[a]),q([]),J([]),X([]),e.abrupt("break",91);case 15:return J([]),X([]),s=[],e.prev=18,W(oe({},M,{loading:!0,error:""})),e.next=22,(0,c.$K)(M.sel_province.label,a);case 22:u=e.sent,((s=u.map((function(e){return e.crop})).filter((function(e,n,t){return t.indexOf(e)===n}))).includes("Rainfed Rice")||s.includes("Irrigated Rice"))&&s.push("Rice"),me.current&&C((function(e){return u})),e.next=31;break;case 28:e.prev=28,e.t1=e.catch(18),W((function(n){return oe({},n,{loading:!1,error:e.t1.message})}));case 31:if(0!==s.length){e.next=34;break}return W((function(e){return oe({},e,{loading:!1,error:"There was an error loading data."})})),e.abrupt("return");case 34:return e.prev=34,e.next=37,(0,o.OP)(M.sel_province.label,a);case 37:d=e.sent,p=[],(b=d.map((function(e){return e.crop})).filter((function(e,n,t){return t.indexOf(e)===n}))).forEach((function(e,n){p.push({id:n,label:e,disabled:!s.includes(e)})})),me.current&&(h=0===b.length?{id:"novalues",label:"No crop types for ".concat(a)}:null,W(oe({},M,{sel_municipality:i,sel_crop:h,sel_stage:[],sel_activity:[],sel_month:null,loading:!1,error:""})),J(p),q((function(e){return p})),R((function(e){return d}))),e.next=47;break;case 44:e.prev=44,e.t2=e.catch(34),W((function(n){return oe({},n,{loading:!1,error:e.t2.message})}));case 47:return e.abrupt("break",91);case 48:return J([]),X([]),W(oe({},M,{sel_crop:i,sel_stage:[],sel_activity:[],sel_month:null})),m=[],k.filter((function(e){return e.crop===a&&e.province===M.sel_province.label&&e.municipality===M.sel_municipality.label})).forEach((function(e){ie.forEach((function(n){""===e[n.id]||m.includes(n.id)||m.push(n.id)}))})),v=se(ie),ie.forEach((function(e,n){v[n].disabled=!m.includes(e.id)})),re(v),e.abrupt("break",91);case 57:return g=A[M.sel_province.label][i.id].label,x=A[M.sel_province.label][i.id].val,X([]),y=[],_=[],k.forEach((function(e,n){var t=Object.values(f.re).find((function(e){return e.format===i.label})).code;if(""!==e[t]&&e.crop===M.sel_crop.label)for(var r=function(e){if(l[e].length>0&&!y.includes(l[e])){y.push(l[e]);var n=w.filter((function(n){return n.stage===f.MZ[l[e].toUpperCase()]&&("Rice"===M.sel_crop.label?["Irrigated Rice","Rainfed Rice"].includes(n.crop):n.crop===M.sel_crop.label)})).map((function(e){return e.activity})).filter((function(e,n,t){return t.indexOf(e)==n}));_.push({id:_.length,label:f.MZ[l[e].toUpperCase()],disabled:0===n.length})}},l=e[t].split(","),a=0;a<l.length;a+=1)r(a)})),Z=0===_.length?[{id:"novalues",label:"No crop stage for ".concat(a)}]:[],J(_),W(oe({},M,{sel_month:i,sel_stage:Z,sel_activity:[],sel_condition:{label:g,id:x}})),e.abrupt("break",91);case 67:for(O in S=[],i)"from"!==O&&S.push(i[O]);return E=[],P=w.filter((function(e){return S.map((function(e){return e.label})).includes(e.stage)&&("Rice"===M.sel_crop.label?["Irrigated Rice","Rainfed Rice"].includes(e.crop):e.crop===M.sel_crop.label)})).map((function(e){return{activity:e.activity,stage:e.stage}})).filter((function(e,n,t){return t.map((function(e){return e.activity})).indexOf(e.activity)===n})),I=0===P.length?[{id:"novalues",label:"No activities for selected options"}]:[],W(oe({},M,{sel_stage:se(S),sel_activity:se(I)})),F=[],P.forEach((function(e,n){F.includes(e.activity)||(E.push({id:n,label:e.activity,stage:e.stage}),F.push(e.activity))})),X((function(e){return E})),e.abrupt("break",91);case 77:e.t3=regeneratorRuntime.keys(M);case 78:if((e.t4=e.t3()).done){e.next=84;break}if(B=e.t4.value,null!==M[B]||"sel_activity"===B){e.next=82;break}return e.abrupt("return");case 82:e.next=78;break;case 84:for(N in L=[],i)"from"!==N&&L.push(i[N]);return z=w.filter((function(e){return L.map((function(e){return e.label})).includes(e.activity)&&M.sel_stage.map((function(e){return e.label})).includes(e.stage)&&("Rice"===M.sel_crop.label?["Irrigated Rice","Rainfed Rice"].includes(e.crop):e.crop===M.sel_crop.label)})).map((function(e){return{province:e.province,municipality:e.municipality,crop:e.crop,stage:e.stage,activity:e.activity,recommendations:function(){switch(M.sel_condition.label){case f.MW.NORMAL.label:return JSON.parse(e.normal).map((function(e){return{id:t.mains.find((function(n){return n.id===e.id})).description,ul:e.ul,subs:e.subs.map((function(e){return t.subs.find((function(n){return n.id===e})).description}))}}));case f.MW.WETTER.label:return JSON.parse(e.wetter).map((function(e){return{id:t.mains.find((function(n){return n.id===e.id})).description,ul:e.ul,subs:e.subs.map((function(e){return t.subs.find((function(n){return n.id===e})).description}))}}));case f.MW.DRIER.label:return JSON.parse(e.drier).map((function(e){return{id:t.mains.find((function(n){return n.id===e.id})).description,ul:e.ul,subs:e.subs.map((function(e){return t.subs.find((function(n){return n.id===e})).description}))}}))}},smsRecommendations:function(){var n="".concat(M.sel_condition.label,"_sms");return void 0!==e[n]?t.sms.find((function(t){return t.id===e[n]})).description:""}}})),W(oe({},M,{sel_activity:se(L)})),T(z),e.abrupt("break",91);case 90:return e.abrupt("break",91);case 91:e.next=94;break;case 93:"province"===l?(W(pe),D([]),q([]),J([]),X([])):"municipality"===l?(W(oe({},M,{sel_municipality:null,sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null})),q([]),J([]),X([])):"crop"===l?(W(oe({},M,{sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null})),J([]),X([])):"month"===l?(W(oe({},M,{sel_month:null,sel_stage:[],sel_activity:[]})),J([]),X([])):"cropstage"===l?(W(oe({},M,{sel_stage:[],sel_activity:[]})),X([])):"activity"===l&&W(oe({},M,{sel_activity:[]}));case 94:case"end":return e.stop()}}),e,null,[[18,28],[34,44]])})));return function(n,t){return e.apply(this,arguments)}}(),ge=function(){var e=le(r().mark((function e(){var n,t,i,l;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return W((function(e){return oe({},e,{loading:!0,error:"",success:""})})),n=Object.values(f.re).find((function(e){return e.format===M.sel_month.label})).code,e.prev=2,t={region:"bicol",province:M.sel_province.label,municipality:M.sel_municipality.label,crop:M.sel_crop.label,month:n,stages:M.sel_stage.map((function(e){return e.label})),activities:M.sel_activity.map((function(e){return e.label})),operation:"create"},W((function(e){return oe({},e,{loading:!0,error:""})})),e.next=7,(0,d.Zn)(t);case 7:i=e.sent,W((function(e){return oe({},e,{loading:!1,success:"Bulletin report created."})})),he(oe({},be,{savesuccess:!0,docId:i.id})),e.next=18;break;case 12:e.prev=12,e.t0=e.catch(2),l="",void 0!==e.t0.response&&(l=void 0!==e.t0.response.data&&"[object Blob]"===ue(e.t0.response.data)?e.t0.response.data:""),""===l&&(l=e.t0.message),W((function(e){return oe({},e,{loading:!1,error:l})}));case 18:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(){return e.apply(this,arguments)}}(),xe=function(){var e=le(r().mark((function e(){var n,t,i,l,a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===Q.url){e.next=3;break}return he(oe({},be,{preview:!0})),e.abrupt("return");case 3:return W((function(e){return oe({},e,{loading:!0,error:"",success:""})})),n=Object.values(f.re).find((function(e){return e.format===M.sel_month.label})).code,e.prev=5,t={region:"bicol",province:M.sel_province.label,municipality:M.sel_municipality.label,crop:M.sel_crop.label,month:n,stages:M.sel_stage.map((function(e){return e.label})),activities:M.sel_activity.map((function(e){return e.label})),operation:"preview"},he(oe({},be,{preview:!0})),W((function(e){return oe({},e,{loading:!0,error:""})})),e.next=11,(0,d.pl)(t);case 11:i=e.sent,l=new Blob([i],{type:"application/pdf"}),(a={}).href=URL.createObjectURL(l),a.download="".concat(M.sel_province.label,"_").concat(M.sel_municipality.label,"-").concat(M.sel_crop.label,".pdf"),Y((function(e){return oe({},e,{url:a.href,filename:a.download})})),W((function(e){return oe({},e,{loading:!1,success:"Bulletin preview created."})})),e.next=26;break;case 20:e.prev=20,e.t0=e.catch(5),o="",void 0!==e.t0.response&&(o=void 0!==e.t0.response.data&&"[object Blob]"===ue(e.t0.response.data)?e.t0.response.data:""),""===o&&(o=e.t0.message),W((function(e){return oe({},e,{loading:!1,error:o})}));case 26:case"end":return e.stop()}}),e,null,[[5,20]])})));return function(){return e.apply(this,arguments)}}();return(0,l.jsx)(te.Z,{loading:e.loading,user:e.user,onBtnLogoutClick:e.onBtnLogoutClick,accLevel:f.DW.ADMIN,children:(0,l.jsx)(ne,{sel_options:M,open:de,provinces:x,recommendations:P,optsmunicipalities:N,optscrops:U,optscropstages:H,optsactivities:$,optsmonths:ie,pdfPreview:Q,steps:b,conditions:[{id:"norm",label:"Normal Conditions"},{id:"wet",label:"Wetter than Normal Conditions"},{id:"dry",label:"Drier than Normal Conditions"}],onSelectItemChange:ve,getStepLabel:function(e){var n=b[e].opt_name,t=["sel_stage","sel_activity"],i=t.includes(n)?0===M[n].length?b[e].label:"".concat(b[e].label,": ").concat(M[n].map((function(e){return e.label})).toString()):null===M[n]?b[e].label:"".concat(b[e].label,": ").concat(M[n].label);return t.includes(n)?0===M[n].length?b[e].label:i:null!==M[n]&&"novalues"===M[n].id?b[e].label:i},isContinueDisabled:function(e){switch(e){case 0:return null===M.sel_province;case 1:return null===M.sel_municipality;case 2:return null===M.sel_crop||"novalues"===M.sel_crop.id;case 3:return null===M.sel_month;case 4:return 0===M.sel_stage.length;case 5:return 0===M.sel_activity.length;default:return!1}},handlePreview:xe,handleSave:ge,toggleViewerOpen:function(){he((function(e){return!e}))}})})}))}},function(e){e.O(0,[3135,9669,3203,6572,8027,8534,3728,8152,6206,9774,2888,179],(function(){return n=5326,e(e.s=n);var n}));var n=e.O();_N_E=n}]);