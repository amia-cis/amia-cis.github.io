(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[755],{5326:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bulletins/crops/create",function(){return t(9919)}])},7513:function(e,n){"use strict";n.Z={container:{padding:"24px",width:"100%",position:"relative",minWidth:"0px",overflowWrap:"break-word",background:"#FFFFFF",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px",borderRadius:"16px",margin:"auto",borderColor:"#E2E8F0"},welcome:{display:"grid",placeContent:"center",marginTop:function(e){return e.spacing(10)},textAlign:"center","& h5":{marginTop:function(e){return e.spacing(2)}}},conditionLegend:{maxWidth:{md:"100%",lg:"270px"},marginBottom:"32px",padding:function(e){return e.spacing(1)},borderRadius:"4px",border:"1px solid grey",textAlign:"center",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px"},autocomplete:{marginTop:function(e){return e.spacing(1)}},recSeasonal:{marginTop:function(e){return e.spacing(1)},"& p, ul":{fontSize:"14px"}},gridContainer:{marginTop:"24px",minHeight:500,width:1,"& .normal":{backgroundColor:"yellow"},"& .drier":{backgroundColor:"red"},"& .wetter":{backgroundColor:"blue"}},button:{color:"#FFFFFF",textTransform:"capitalize",fontSize:"14px",fontStyle:"normal",fontWeight:"normal",width:"80px",height:{xs:"40px",sm:"50px"}}}},3080:function(e,n,t){"use strict";var i=t(5893),r=t(7357),l=t(8456);n.Z=function(e){var n=e.text,t=void 0===n?"":n,a=e.size,o=void 0===a?24:a,s=e.children;return(0,i.jsxs)(r.Z,{sx:{width:"100%",textAlign:"center",height:"20vh"},children:[(0,i.jsxs)(r.Z,{sx:{width:"100%",textAlign:"center",marginTop:function(e){return e.spacing(12)},marginBottom:"32px",display:"flex",justifyContent:"center"},children:[(0,i.jsx)("span",{children:""!==t?t:"Loading..."})," \xa0",(0,i.jsx)(l.Z,{size:o})]}),s]})}},9919:function(e,n,t){"use strict";t.r(n),t.d(n,{__N_SSG:function(){return pe},default:function(){return fe}});var i=t(4051),r=t.n(i),l=t(5893),a=t(7294),o=t(2848),s=t(1652),c=t(4680),u=t(560),d=t(8152),p=t(7682),f=t(7426),h=[{label:"Select a province",description:"Select a province within the Bicol region.",opt_name:"sel_province"},{label:"Select a municipality",description:"Select a municipality included in the province you have selected on step no. 1.",opt_name:"sel_municipality"},{label:"Select a crop type",description:"Listed below are available crops for your selected province and municipality.",opt_name:"sel_crop"},{label:"Select a month",description:"Select a target month from the current Seasonal Weather Forecast.",opt_name:"sel_month"},{label:"Select crop stages",description:"Listed below are the available crop stages for your selected crop on the target month.",opt_name:"sel_stage"},{label:"Select activities",description:"Here are available activities for the previously-selected parameters.",opt_name:"sel_activity"}],m=t(3059),b=t(1163),v=t(5697),g=t.n(v),x=t(1664),_=t(5675),y=t(6295),j=t(7357),Z=t(9368),S=t(8456),w=t(1057),O=t(6863),C=t(657),k=t(1425),R=t(6580),E=t(8951),P=t(7645),T=t(7720),I=t(6886),A=t(5113),B=t(6624),F=t(710),L=t(3578),q=t(6229),N=t(1903),M=t(5861),W=t(8409),D=t(44),z=t(120),U=t(1033),V=t(3080),K=t(9794),H=t(9628),J=t(7171),$=t(7513);function X(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function G(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},i=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),i.forEach((function(n){X(e,n,t[n])}))}return e}function Q(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},l=Object.keys(e);for(i=0;i<l.length;i++)t=l[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(i=0;i<l.length;i++)t=l[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var Y=["sel_province","sel_municipality","sel_crop","sel_month","sel_stage","sel_activity"];var ee=function(e){var n=function(e){var n=e.children,t=e.value,i=e.index,r=Q(e,["children","value","index"]);return(0,l.jsx)("div",G({role:"tabpanel",hidden:t!==i,id:"simple-tabpanel-".concat(i),"aria-labelledby":"simple-tab-".concat(i)},r,{children:t===i&&(0,l.jsx)(j.Z,{sx:{p:3},children:(0,l.jsx)(M.Z,{children:n})})}))},t=function(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}},i=(0,a.useState)(0),r=i[0],o=i[1],s=(0,a.useRef)(!0),c=(0,b.useRouter)(),u=(0,a.useState)(!0),d=u[0],p=u[1],h=(0,a.useState)(0),m=h[0],v=h[1],X=e.sel_options,ee=e.provinces,ne=e.recommendations,te=e.onSelectItemChange,ie=e.optsmunicipalities,re=e.optscrops,le=e.optscropstages,ae=e.optsactivities,oe=e.optsmonths,se=e.open,ce=e.pdfPreview,ue=e.steps,de=e.getStepLabel,pe=e.isContinueDisabled,fe=e.handleSave,he=e.handlePreview,me=e.toggleViewerOpen,be=(0,l.jsx)(H.Z,{fontSize:"small"}),ve=(0,l.jsx)(J.Z,{fontSize:"small"});(0,a.useEffect)((function(){return s.current=!0,function(){s.current=!1}}),[]);var ge=function(){p(!1),setTimeout((function(){(s.current=!0)&&p(!0)}),500),o((function(e){return e+1}))},xe=function(){o((function(e){return e-1}))},_e=function(){var e="Loading...";return ee.length>0&&(e=null===X.sel_province?"Select a province":"Province"),e};return n.propTypes={children:g().node,index:g().number.isRequired,value:g().number.isRequired},(0,l.jsxs)("div",{children:[(0,l.jsxs)(C.Z,{open:se.savesuccess,"aria-labelledby":"data-saved-success","aria-describedby":"alert-dialog-description",children:[(0,l.jsx)(P.Z,{id:"data-saved-success",children:"Success"}),(0,l.jsx)(R.Z,{children:(0,l.jsx)(E.Z,{id:"alert-dialog-description",children:"Success! Bulletin report created."})}),(0,l.jsx)(k.Z,{children:(0,l.jsx)(w.Z,{onClick:function(){c.push("/admin/bulletins/crops/view/?docId=".concat(se.docId))},autoFocus:!0,children:"OK"})})]}),(0,l.jsxs)(C.Z,{open:se.preview,maxWidth:"lg",fullWidth:!0,"aria-labelledby":"data-saved-success","aria-describedby":"alert-dialog-description",children:[(0,l.jsx)(P.Z,{id:"data-saved-success",children:""!==ce.filename?"Bulletin Preview - ".concat(ce.filename):"Bulletin Preview"}),(0,l.jsx)(R.Z,{sx:{padding:0,overflow:"hidden"},children:(0,l.jsx)(j.Z,{id:"alert-dialog-description",children:X.loading?(0,l.jsx)("div",{style:{width:"100%",height:"90vh",textAlign:"center"},children:(0,l.jsx)(V.Z,{text:"Loading Preview...",children:(0,l.jsx)(_.default,{unoptimized:!0,src:(0,z.assetPrefixer)("images/icons/data-processing-128.png"),height:100,width:100,loader:z.imageLoader,alt:"Loading Preview"})})}):""!==X.error?(0,l.jsx)("div",{style:{width:"100%",height:"100vh"},children:(0,l.jsx)(U.Z,{message:X.error})}):(0,l.jsx)("embed",{src:ce.url,style:{width:"100%",height:"70vh"}})})}),(0,l.jsx)(k.Z,{children:(0,l.jsx)(w.Z,{variant:"contained",onClick:me,autoFocus:!0,children:"OK"})})]}),(0,l.jsxs)(I.ZP,{container:!0,sx:$.Z.container,children:[(0,l.jsxs)(j.Z,{sx:{marginBottom:"32px"},children:[(0,l.jsx)(M.Z,{variant:"h5",children:"Create Crop Recommendations Bulletins"}),(0,l.jsxs)("p",{children:["Create ",(0,l.jsx)("strong",{children:"Seasonal"})," crop recommendations bulletins. Finalized bulletins will be automatically uploaded to the site for public download."]})]}),(0,l.jsxs)(I.ZP,{item:!0,sx:$.Z.item,xs:12,lg:4,children:[(0,l.jsxs)(j.Z,{sx:{minWidth:"100%",paddingRight:function(e){return e.spacing(2)}},children:[(0,l.jsx)(M.Z,{variant:"h6",children:"Selection Options"}),(0,l.jsx)(B.Z,{activeStep:r,orientation:"vertical",children:ue.map((function(e,n){return(0,l.jsxs)(F.Z,{children:[(0,l.jsx)(L.Z,{optional:5===n?(0,l.jsx)(M.Z,{variant:"caption",children:"Last step"}):null,children:de(n)}),(0,l.jsxs)(q.Z,{children:[(0,l.jsx)(M.Z,{variant:"subtitle",children:e.description}),0===n&&(0,l.jsx)(y.Z,{disablePortal:!0,id:"province",value:X.sel_province,disabled:0===ee.length,options:ee,sx:$.Z.autocomplete,renderInput:function(e){return(0,l.jsx)(N.Z,G({},e,{label:_e()}))},isOptionEqualToValue:function(e,n){return e.label===n.label},onChange:function(e,n){return te(e,G({},n,{from:"province"}))}}),1===n&&(0,l.jsx)(y.Z,{disablePortal:!0,id:"municipality",value:X.sel_municipality,disabled:0===ie.length||X.loading,options:ie,sx:$.Z.autocomplete,renderInput:function(e){return(0,l.jsx)(N.Z,G({},e,{label:null===X.sel_municipality?"Select a municipality":"Municipality"}))},isOptionEqualToValue:function(e,n){return e.label===n.label},onChange:function(e,n){return te(e,G({},n,{from:"municipality"}))}}),2===n&&(0,l.jsx)(y.Z,{disablePortal:!0,id:"crop",value:X.sel_crop,disabled:0===re.length,options:re,sx:$.Z.autocomplete,renderInput:function(e){return(0,l.jsx)(N.Z,G({},e,{label:null===X.sel_crop?"Select a crop type":"Crop"}))},isOptionEqualToValue:function(e,n){return e.label===n.label},getOptionDisabled:function(e){return e.disabled},onChange:function(e,n){return te(e,G({},n,{from:"crop"}))}}),3===n&&(0,l.jsx)(y.Z,{disablePortal:!0,id:"month",value:X.sel_month,disabled:0===oe.length||null===X.sel_crop,options:oe,sx:$.Z.autocomplete,renderInput:function(e){return(0,l.jsx)(N.Z,G({},e,{label:null===X.sel_month?"Select a Month":"Month"}))},isOptionEqualToValue:function(e,n){return e.label===n.label},getOptionDisabled:function(e){return e.disabled},onChange:function(e,n){return te(e,G({},n,{from:"month"}))}}),4===n&&(0,l.jsx)(y.Z,{disablePortal:!0,id:"cropstage",multiple:!0,disableCloseOnSelect:!0,limitTags:1,value:X.sel_stage,disabled:0===le.length,options:le,sx:$.Z.autocomplete,renderInput:function(e){return(0,l.jsx)(N.Z,G({},e,{label:0===X.sel_stage.length?"Select crop stages":"Crop Stages"}))},getOptionDisabled:function(e){return e.disabled},onChange:function(e,n){return te(e,G({},n,{from:"cropstage"}))},renderOption:function(e,n,t){var i=t.selected;return(0,l.jsxs)("li",G({},e,{children:[(0,l.jsx)(Z.Z,{id:"cropstage",icon:be,checkedIcon:ve,style:{marginRight:8},checked:i}),n.label]}))}}),5===n&&(0,l.jsx)(y.Z,{disablePortal:!0,id:"activity",multiple:!0,disableCloseOnSelect:!0,limitTags:1,value:X.sel_activity,disabled:0===ae.length,options:ae.sort((function(e,n){return n.stage.localeCompare(e.stage)})),groupBy:function(e){return e.stage},sx:$.Z.autocomplete,renderInput:function(e){return(0,l.jsx)(N.Z,G({},e,{label:0===X.sel_activity.length?"Select activities":"Activities"}))},getOptionDisabled:function(e){return e.disabled},onChange:function(e,n){return te(e,G({},n,{from:"activity"}))},renderOption:function(e,n,t){var i=t.selected;return(0,l.jsxs)("li",G({},e,{children:[(0,l.jsx)(Z.Z,{id:"activity",icon:be,checkedIcon:ve,style:{marginRight:8},checked:i}),n.label]}))}}),""!==X.error&&(0,l.jsx)(M.Z,{variant:"caption",sx:{color:"red"},children:X.error}),(0,l.jsx)(j.Z,{sx:{mb:2,marginTop:"24px"},children:(0,l.jsxs)("div",{children:[(0,l.jsx)(w.Z,{variant:"contained",disabled:pe(n)||X.loading||!d,onClick:ge,children:n===ue.length-1?"Finish":"Continue"}),(0,l.jsx)(w.Z,{disabled:X.loading||!d||0===n,onClick:xe,children:"Back"})]})})]})]},e.label)}))}),r===ue.length&&(0,l.jsxs)(A.Z,{square:!0,elevation:0,sx:{p:3},children:[(0,l.jsx)(M.Z,{children:"All steps completed"}),(0,l.jsx)(w.Z,{onClick:function(){o(0),te(null,{from:"province"})},sx:{mt:1,mr:1},children:"Restart"}),(0,l.jsx)(w.Z,{onClick:xe,sx:{mt:1,mr:1},children:"Back"})]})]}),null!==X.sel_month&&(0,l.jsxs)(j.Z,{sx:$.Z.conditionLegend,style:{backgroundColor:f.tN[X.sel_condition.label]},children:[(0,l.jsx)(M.Z,{variant:"subtitle2",children:"Seasonal Weather Condition"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{children:X.sel_month.label})," \xa0",(0,l.jsxs)("span",{children:["".concat(X.sel_condition.label.charAt(0).toUpperCase()).concat(X.sel_condition.label.slice(1))," ","(",X.sel_condition.id,"%)"]})]})]})]}),(0,l.jsx)(I.ZP,{item:!0,sx:$.Z.item,xs:12,lg:8,children:null!==X.sel_crop&&null!==X.sel_activity&&6===r?(0,l.jsxs)("div",{children:[null!==X.sel_crop&&null!==X.sel_activity&&(0,l.jsxs)("div",{children:[(0,l.jsxs)(M.Z,{variant:"h4",sx:{display:0===X.sel_activity.length?"none":"flex"},children:[X.sel_crop.label," Recommendations"]}),(0,l.jsx)(M.Z,{variant:"h5",children:"".concat(X.sel_condition.label.charAt(0).toUpperCase()).concat(X.sel_condition.label.slice(1)," Condition")})]}),(0,l.jsxs)(j.Z,{sx:{width:"100%"},children:[(0,l.jsx)(j.Z,{sx:{borderBottom:1,borderColor:"divider"},children:(0,l.jsxs)(W.Z,{value:m,onChange:function(e,n){v(n)},"aria-label":"basic tabs example",children:[(0,l.jsx)(D.Z,G({label:"PDF FORM"},t(0))),(0,l.jsx)(D.Z,G({label:"SMS FORM"},t(1)))]})}),(0,l.jsx)(n,{value:m,index:0,children:ne.length>0?ne.map((function(e,n){var t="Rice"===X.sel_crop.label?"(".concat(e.crop,")"):"";return(0,l.jsxs)(j.Z,{sx:$.Z.recSeasonal,children:[(0,l.jsxs)(M.Z,{variant:"h5",children:[e.stage," - ",e.activity," ",t]}),e.recommendations().map((function(e,t){return e.ul?(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:e.id}),e.subs.length>0&&(0,l.jsx)("ul",{children:e.subs.map((function(e,t){return(0,l.jsx)("li",{children:e},"sub-".concat(n,"-").concat(t))}))})]},"main-".concat(n,"-").concat(t)):(0,l.jsx)("p",{children:e.id},"main-".concat(n,"-").concat(t))}))]},"rec-".concat(n))})):(0,l.jsx)(U.Z,{message:"We cannot find recommendations for your selected options."})}),(0,l.jsx)(n,{value:m,index:1,children:(0,l.jsxs)("div",{children:[(0,l.jsxs)(M.Z,{variant:"body2",sx:{fontStyle:"italic"},children:[(0,l.jsx)("strong",{children:"NOTE:"})," This shortened version will serve as a Text to be sent as SMS."]}),(0,l.jsx)("br",{}),(0,l.jsxs)(M.Z,{variant:"body1",gutterBottom:!0,children:[(0,l.jsx)("p",{children:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quos blanditiis tenetur unde suscipit, quam beatae rerum inventore consectetur, neque doloribus, cupiditate numquam dignissimos laborum fugiat deleniti? Eum quasi quidem quibusdam."}),(0,l.jsx)("p",{children:"Vulputate odio ut enim blandit volutpat maecenas volutpat blandit aliquam etiam erat velit scelerisque in dictum non consectetur a erat nam at lectus urna duis convallis convallis tellus id interdum velit laoreet id donec ultrices tincidunt arcu non sodales neque sodales ut etiam sit amet nisl purus in mollis nunc sed id semper risus in hendrerit gravida rutrum quisque non tellus orci ac auctor augue mauris augue neque gravida in fermentum et sollicitudin ac orci phasellus egestas tellus rutrum tellus pellentesque eu tincidunt tortor aliquam nulla facilisi cras fermentum odio eu feugiat pretium nibh ipsum consequat nisl vel pretium lectus"})]})]})})]})]}):Object.values(X).filter((function(e){return e})).length>3?(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center"},children:Y.map((function(e,n){var t=["sel_stage","sel_activity"].includes(e)?X[e].length>0&&"weather_condition"!==X[e].from:null!==X[e]&&void 0!==X[e]&&void 0!==X[e].from&&"weather_condition"!==X[e].from,i=["sel_stage","sel_activity"].includes(e)?{from:{sel_stage:"cropstage",sel_activity:"activity"}[e],label:X[e].map((function(e){return e.label})).toString().split(",").join(", ")}:X[e];return t?(0,l.jsx)(K.Z,{info:i,show:n<Y.length-1},"card-opt-".concat(n)):(0,l.jsx)("div",{},"card-opt-".concat(n))}))}):(0,l.jsxs)(j.Z,{sx:$.Z.welcome,children:[(0,l.jsx)(_.default,{unoptimized:!0,src:(0,z.assetPrefixer)("images/icons/finance.svg"),height:120,width:120,loader:z.imageLoader,alt:"Empty data"}),(0,l.jsx)(M.Z,{variant:"h5",children:"Crop Recommendations PDF Bulletins Creator"}),(0,l.jsx)(M.Z,{variant:"p",children:"Please select a province to start."})]})}),(0,l.jsxs)(j.Z,{sx:{marginBottom:"16px",width:"100%",display:6===r?"block":"none"},children:[(0,l.jsx)("br",{}),(0,l.jsx)(T.Z,{}),(0,l.jsx)("br",{}),""!==X.error&&(0,l.jsxs)(M.Z,{variant:"caption",sx:{color:"red"},children:["Error: ",X.error]}),(0,l.jsxs)(O.Z,{size:"large","aria-label":"large button group",sx:{display:"flex",justifyContent:"flex-end",marginTop:"8px"},children:[(0,l.jsx)(x.default,{href:"/admin/bulletins/crops",passHref:!0,children:(0,l.jsx)(w.Z,{disabled:X.loading,children:"Cancel"})}),(0,l.jsxs)(w.Z,{disabled:X.loading,onClick:he,children:[(0,l.jsx)("span",{style:{display:X.loading?"none":"block"},children:"Preview"})," ","\xa0",(0,l.jsx)(S.Z,{size:20,color:"secondary",sx:{display:X.loading?"block":"none"}})]}),(0,l.jsx)(w.Z,{variant:"contained",onClick:fe,disableElevation:!0,disabled:X.loading,children:"Save"})]})]})]})]})},ne=t(2530);function te(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}function ie(e,n,t,i,r,l,a){try{var o=e[l](a),s=o.value}catch(c){return void t(c)}o.done?n(s):Promise.resolve(s).then(i,r)}function re(e){return function(){var n=this,t=arguments;return new Promise((function(i,r){var l=e.apply(n,t);function a(e){ie(l,i,r,a,o,"next",e)}function o(e){ie(l,i,r,a,o,"throw",e)}a(void 0)}))}}function le(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function ae(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},i=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),i.forEach((function(n){le(e,n,t[n])}))}return e}function oe(e){return function(e){if(Array.isArray(e))return te(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"===typeof e)return te(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return te(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var se=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};var ce={sel_province:null,sel_municipality:null,sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null,sel_condition:{id:0,from:"weather_condition",label:f.MW.DRIER.label},loading:!1,error:"",success:""},ue={url:"",filename:""},de={preview:!1,savesuccess:!1,docId:""};var pe=!0,fe=(0,m.Z)((function(e){var n=(0,p.Kx)(c.o.CROP_REC_LIST_RECS_MAIN,"id"),t=n.documents,i=n.loading,m=(0,p.Kx)(c.o.CROP_REC_LIST_RECS_SUB,"id"),b=m.documents,v=m.loading,g=(0,p.m$)(u.M.WEATHER_FORECASTS,"bicol",u.M.SUB_SEASONAL,"name"),x=g.documents,_=g.loading,y=(0,a.useState)([]),j=y[0],Z=y[1],S=(0,a.useState)([]),w=S[0],O=S[1],C=(0,a.useState)([]),k=C[0],R=C[1],E=(0,a.useState)([]),P=E[0],T=E[1],I=(0,a.useState)([]),A=I[0],B=I[1],F=(0,a.useState)({}),L=F[0],q=F[1],N=(0,a.useState)(ce),M=N[0],W=N[1],D=(0,a.useState)([]),z=D[0],U=D[1],V=(0,a.useState)([]),K=V[0],H=V[1],J=(0,a.useState)([]),$=J[0],X=J[1],G=(0,a.useState)([]),Q=G[0],Y=G[1],te=(0,a.useState)(ue),ie=te[0],le=te[1],pe=(0,a.useState)([]),fe=pe[0],he=pe[1],me=(0,a.useState)(de),be=me[0],ve=me[1],ge=(0,a.useRef)(!1);(0,a.useEffect)((function(){return ge.current=!0,function(){ge.current=!1}}),[]),(0,a.useEffect)((function(){if(e.municipalities.length>0&&!i&&!v&&!_){var n={};x.forEach((function(e){var t=e.name.split("_").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join(" ");n[t]={},e.months.forEach((function(e){n[t][e.mo]={label:e.con,val:e.val}}))}));var t=[];x[0].mos.forEach((function(e){t.push({id:f.re[e.toUpperCase()].code,label:f.re[e.toUpperCase()].format,disabled:!1})}));var r={},l=[];e.municipalities.forEach((function(e,n){void 0===r[e.province]?(l.push({id:n,label:e.province}),r[e.province]=[{id:0,label:e.name}]):r[e.province].push({id:r[e.province].length,label:e.name})})),ge.current&&(O(r),Z(l),he(t),q(n))}}),[e.municipalities,x,i,v,_]);var xe=function(){var e=re(r().mark((function e(n,i){var l,a,c,u,d,p,h,m,v,g,x,_,y,j,Z,S,O,C,E,I,A,F,q,N,D;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=i.from,a=i.label,n&&n.preventDefault(),B([]),le(ue),!(["cropstage","activity"].includes(l)?Object.keys(i).length>1:Object.keys(i).includes("id"))){e.next=93;break}e.t0=l,e.next="province"===e.t0?9:"municipality"===e.t0?15:"crop"===e.t0?48:"month"===e.t0?57:"cropstage"===e.t0?67:"activity"===e.t0?77:90;break;case 9:return W(ae({},M,{sel_province:i,sel_municipality:null,sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null})),U(w[a]),H([]),X([]),Y([]),e.abrupt("break",91);case 15:return X([]),Y([]),c=[],e.prev=18,W(ae({},M,{loading:!0,error:""})),e.next=22,(0,s.$K)(M.sel_province.label,a);case 22:u=e.sent,((c=u.map((function(e){return e.crop})).filter((function(e,n,t){return t.indexOf(e)===n}))).includes("Rainfed Rice")||c.includes("Irrigated Rice"))&&c.push("Rice"),ge.current&&R((function(e){return u})),e.next=31;break;case 28:e.prev=28,e.t1=e.catch(18),W((function(n){return ae({},n,{loading:!1,error:e.t1.message})}));case 31:if(0!==c.length){e.next=34;break}return W((function(e){return ae({},e,{loading:!1,error:"There was an error loading data."})})),e.abrupt("return");case 34:return e.prev=34,e.next=37,(0,o.OP)(M.sel_province.label,a);case 37:d=e.sent,p=[],(h=d.map((function(e){return e.crop})).filter((function(e,n,t){return t.indexOf(e)===n}))).forEach((function(e,n){p.push({id:n,label:e,disabled:!c.includes(e)})})),ge.current&&(m=0===h.length?{id:"novalues",label:"No crop types for ".concat(a)}:null,W(ae({},M,{sel_municipality:i,sel_crop:m,sel_stage:[],sel_activity:[],sel_month:null,loading:!1,error:""})),X(p),H((function(e){return p})),T((function(e){return d}))),e.next=47;break;case 44:e.prev=44,e.t2=e.catch(34),W((function(n){return ae({},n,{loading:!1,error:e.t2.message})}));case 47:return e.abrupt("break",91);case 48:return X([]),Y([]),W(ae({},M,{sel_crop:i,sel_stage:[],sel_activity:[],sel_month:null})),v=[],P.filter((function(e){return e.crop===a&&e.province===M.sel_province.label&&e.municipality===M.sel_municipality.label})).forEach((function(e){fe.forEach((function(n){""===e[n.id]||v.includes(n.id)||v.push(n.id)}))})),g=oe(fe),fe.forEach((function(e,n){g[n].disabled=!v.includes(e.id)})),he(g),e.abrupt("break",91);case 57:return x=L[M.sel_province.label][i.id].label,_=L[M.sel_province.label][i.id].val,Y([]),y=[],j=[],P.forEach((function(e,n){var t=Object.values(f.re).find((function(e){return e.format===i.label})).code;if(""!==e[t]&&e.crop===M.sel_crop.label)for(var r=function(e){if(l[e].length>0&&!y.includes(l[e])){y.push(l[e]);var n=k.filter((function(n){return n.stage===f.MZ[l[e].toUpperCase()]&&("Rice"===M.sel_crop.label?["Irrigated Rice","Rainfed Rice"].includes(n.crop):n.crop===M.sel_crop.label)})).map((function(e){return e.activity})).filter((function(e,n,t){return t.indexOf(e)==n}));j.push({id:j.length,label:f.MZ[l[e].toUpperCase()],disabled:0===n.length})}},l=e[t].split(","),a=0;a<l.length;a+=1)r(a)})),Z=0===j.length?[{id:"novalues",label:"No crop stage for ".concat(a)}]:[],X(j),W(ae({},M,{sel_month:i,sel_stage:Z,sel_activity:[],sel_condition:{label:x,id:_}})),e.abrupt("break",91);case 67:for(O in S=[],i)"from"!==O&&S.push(i[O]);return C=[],E=k.filter((function(e){return S.map((function(e){return e.label})).includes(e.stage)&&("Rice"===M.sel_crop.label?["Irrigated Rice","Rainfed Rice"].includes(e.crop):e.crop===M.sel_crop.label)})).map((function(e){return{activity:e.activity,stage:e.stage}})).filter((function(e,n,t){return t.map((function(e){return e.activity})).indexOf(e.activity)===n})),I=0===E.length?[{id:"novalues",label:"No activities for selected options"}]:[],W(ae({},M,{sel_stage:oe(S),sel_activity:oe(I)})),A=[],E.forEach((function(e,n){A.includes(e.activity)||(C.push({id:n,label:e.activity,stage:e.stage}),A.push(e.activity))})),Y((function(e){return C})),e.abrupt("break",91);case 77:e.t3=regeneratorRuntime.keys(M);case 78:if((e.t4=e.t3()).done){e.next=84;break}if(F=e.t4.value,null!==M[F]||"sel_activity"===F){e.next=82;break}return e.abrupt("return");case 82:e.next=78;break;case 84:for(N in q=[],i)"from"!==N&&q.push(i[N]);return D=k.filter((function(e){return q.map((function(e){return e.label})).includes(e.activity)&&M.sel_stage.map((function(e){return e.label})).includes(e.stage)&&("Rice"===M.sel_crop.label?["Irrigated Rice","Rainfed Rice"].includes(e.crop):e.crop===M.sel_crop.label)})).map((function(e){return{province:e.province,municipality:e.municipality,crop:e.crop,stage:e.stage,activity:e.activity,recommendations:function(){switch(M.sel_condition.label){case f.MW.NORMAL.label:return JSON.parse(e.normal).map((function(e){return{id:t.find((function(n){return n.id===e.id})).description,ul:e.ul,subs:e.subs.map((function(e){return b.find((function(n){return n.id===e})).description}))}}));case f.MW.WETTER.label:return JSON.parse(e.wetter).map((function(e){return{id:t.find((function(n){return n.id===e.id})).description,ul:e.ul,subs:e.subs.map((function(e){return b.find((function(n){return n.id===e})).description}))}}));case f.MW.DRIER.label:return JSON.parse(e.drier).map((function(e){return{id:t.find((function(n){return n.id===e.id})).description,ul:e.ul,subs:e.subs.map((function(e){return b.find((function(n){return n.id===e})).description}))}}))}}}})),W(ae({},M,{sel_activity:oe(q)})),B(D),e.abrupt("break",91);case 90:return e.abrupt("break",91);case 91:e.next=94;break;case 93:"province"===l?(W(ce),U([]),H([]),X([]),Y([])):"municipality"===l?(W(ae({},M,{sel_municipality:null,sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null})),H([]),X([]),Y([])):"crop"===l?(W(ae({},M,{sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null})),X([]),Y([])):"month"===l?(W(ae({},M,{sel_month:null,sel_stage:[],sel_activity:[]})),X([]),Y([])):"cropstage"===l?(W(ae({},M,{sel_stage:[],sel_activity:[]})),Y([])):"activity"===l&&W(ae({},M,{sel_activity:[]}));case 94:case"end":return e.stop()}}),e,null,[[18,28],[34,44]])})));return function(n,t){return e.apply(this,arguments)}}(),_e=function(){var e=re(r().mark((function e(){var n,t,i,l;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return W((function(e){return ae({},e,{loading:!0,error:"",success:""})})),n=Object.values(f.re).find((function(e){return e.format===M.sel_month.label})).code,e.prev=2,t={region:"bicol",province:M.sel_province.label,municipality:M.sel_municipality.label,crop:M.sel_crop.label,month:n,stages:M.sel_stage.map((function(e){return e.label})),activities:M.sel_activity.map((function(e){return e.label})),operation:"create"},W((function(e){return ae({},e,{loading:!0,error:""})})),e.next=7,(0,d.Zn)(t);case 7:i=e.sent,W((function(e){return ae({},e,{loading:!1,success:"Bulletin report created."})})),ve(ae({},de,{savesuccess:!0,docId:i.id})),e.next=18;break;case 12:e.prev=12,e.t0=e.catch(2),l="",void 0!==e.t0.response&&(l=void 0!==e.t0.response.data&&"[object Blob]"===se(e.t0.response.data)?e.t0.response.data:""),""===l&&(l=e.t0.message),W((function(e){return ae({},e,{loading:!1,error:l})}));case 18:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(){return e.apply(this,arguments)}}(),ye=function(){var e=re(r().mark((function e(){var n,t,i,l,a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===ie.url){e.next=3;break}return ve(ae({},de,{preview:!0})),e.abrupt("return");case 3:return W((function(e){return ae({},e,{loading:!0,error:"",success:""})})),n=Object.values(f.re).find((function(e){return e.format===M.sel_month.label})).code,e.prev=5,t={region:"bicol",province:M.sel_province.label,municipality:M.sel_municipality.label,crop:M.sel_crop.label,month:n,stages:M.sel_stage.map((function(e){return e.label})),activities:M.sel_activity.map((function(e){return e.label})),operation:"preview"},ve(ae({},de,{preview:!0})),W((function(e){return ae({},e,{loading:!0,error:""})})),e.next=11,(0,d.pl)(t);case 11:i=e.sent,l=new Blob([i],{type:"application/pdf"}),(a={}).href=URL.createObjectURL(l),a.download="".concat(M.sel_province.label,"_").concat(M.sel_municipality.label,"-").concat(M.sel_crop.label,".pdf"),le((function(e){return ae({},e,{url:a.href,filename:a.download})})),W((function(e){return ae({},e,{loading:!1,success:"Bulletin preview created."})})),e.next=26;break;case 20:e.prev=20,e.t0=e.catch(5),o="",void 0!==e.t0.response&&(o=void 0!==e.t0.response.data&&"[object Blob]"===se(e.t0.response.data)?e.t0.response.data:""),""===o&&(o=e.t0.message),W((function(e){return ae({},e,{loading:!1,error:o})}));case 26:case"end":return e.stop()}}),e,null,[[5,20]])})));return function(){return e.apply(this,arguments)}}();return(0,l.jsx)(ne.Z,{loading:e.loading,user:e.user,onBtnLogoutClick:e.onBtnLogoutClick,accLevel:f.DW.ADMIN,children:(0,l.jsx)(ee,{sel_options:M,open:be,provinces:j,recommendations:A,optsmunicipalities:z,optscrops:K,optscropstages:$,optsactivities:Q,optsmonths:fe,pdfPreview:ie,steps:h,conditions:[{id:"norm",label:"Normal Conditions"},{id:"wet",label:"Wetter than Normal Conditions"},{id:"dry",label:"Drier than Normal Conditions"}],onSelectItemChange:xe,getStepLabel:function(e){var n=h[e].opt_name,t=["sel_stage","sel_activity"],i=t.includes(n)?0===M[n].length?h[e].label:"".concat(h[e].label,": ").concat(M[n].map((function(e){return e.label})).toString()):null===M[n]?h[e].label:"".concat(h[e].label,": ").concat(M[n].label);return t.includes(n)?0===M[n].length?h[e].label:i:null!==M[n]&&"novalues"===M[n].id?h[e].label:i},isContinueDisabled:function(e){switch(e){case 0:return null===M.sel_province;case 1:return null===M.sel_municipality;case 2:return null===M.sel_crop||"novalues"===M.sel_crop.id;case 3:return null===M.sel_month;case 4:return 0===M.sel_stage.length;case 5:return 0===M.sel_activity.length;default:return!1}},handlePreview:ye,handleSave:_e,toggleViewerOpen:function(){ve((function(e){return!e}))}})})}))}},function(e){e.O(0,[135,669,203,572,27,534,728,152,53,774,888,179],(function(){return n=5326,e(e.s=n);var n}));var n=e.O();_N_E=n}]);