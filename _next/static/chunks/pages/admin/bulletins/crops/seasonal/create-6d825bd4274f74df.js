(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7970],{7645:function(e,n,t){"use strict";var r=t(7462),i=t(3366),a=t(7294),l=t(6010),o=t(7192),s=t(5861),c=t(1496),u=t(3616),d=t(4472),p=t(4182),f=t(5893);const m=["className","id"],b=(0,c.ZP)(s.Z,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(e,n)=>n.root})({padding:"16px 24px",flex:"0 0 auto"}),v=a.forwardRef((function(e,n){const t=(0,u.Z)({props:e,name:"MuiDialogTitle"}),{className:s,id:c}=t,v=(0,i.Z)(t,m),h=t,x=(e=>{const{classes:n}=e;return(0,o.Z)({root:["root"]},d.a,n)})(h),{titleId:g=c}=a.useContext(p.Z);return(0,f.jsx)(b,(0,r.Z)({component:"h2",className:(0,l.Z)(x.root,s),ownerState:h,ref:n,variant:"h6",id:g},v))}));n.Z=v},108:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bulletins/crops/seasonal/create",function(){return t(8289)}])},8289:function(e,n,t){"use strict";t.r(n),t.d(n,{__N_SSG:function(){return se},default:function(){return ce}});var r=t(4051),i=t.n(r),a=t(5893),l=t(7294),o=t(9473),s=t(2848),c=t(1652),u=t(560),d=t(4680),p=t(8152),f=t(7682),m=t(3063),b=t(2671),v=t(1690),h=t(901),x=t(7426),g=t(7392),y=t(5243),_=t(1163),j=t(5697),O=t.n(j),S=t(1023),Z=t(3946),w=t(1664),E=t(5675),k=t(6295),R=t(7357),P=t(8456),A=t(1057),C=t(6863),M=t(7720),L=t(6886),N=t(9227),I=t(1903),T=t(5861),B=t(8409),W=t(44),D=t(6660),z=t(1829),U=t(2094),F=t(6938);function V(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function G(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){V(e,n,t[n])}))}return e}function q(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var H=[{key:"sel_province",label:"Province"},{key:"sel_municipality",label:"Municipality"},{key:"sel_crop",label:"Crop"},{key:"sel_month",label:"Months"},{key:"sel_stage",label:"Crop Stages"},{key:"sel_activity",label:"Activities"}];var J=function(e){var n=function(e){var n=e.children,t=e.value,r=e.index,i=q(e,["children","value","index"]);return(0,a.jsx)("div",G({role:"tabpanel",hidden:t!==r,id:"simple-tabpanel-".concat(r),"aria-labelledby":"simple-tab-".concat(r)},i,{children:t===r&&(0,a.jsx)(R.Z,{sx:{p:3},children:n})}))},t=function(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}},r=(0,l.useRef)(!0),i=(0,_.useRouter)(),s=(0,o.I0)(),c=(0,l.useState)(0),u=c[0],d=c[1],p=(0,l.useState)(!1),f=p[0],m=p[1],v=(0,o.v9)((function(e){return e.reports})),g=v.status,y=v.error,j=e.sel_options,V=e.provinces,J=e.recommendations,Y=e.onSelectItemChange,X=e.optsmunicipalities,$=e.optscrops,K=e.optsmonths,Q=e.open,ee=e.message,ne=e.smstext,te=e.pdfPreview,re=e.handleSave,ie=e.handlePreview,ae=e.togglePrompt,le=e.toggleViewerOpen,oe=e.generateRecommendations,se=e.resetSelections;(0,l.useEffect)((function(){return r.current=!0,function(){r.current=!1}}),[]),(0,l.useEffect)((function(){m(j.loading||g===h.G.PENDING)}),[j.loading,g]);var ce=function(){s((0,b.s_)()),i.push("/admin/bulletins/crops/report/view/?docId=".concat(ee.docId))},ue=function(){var e="Loading...";return V.length>0&&(e=null===j.sel_province?"Select a province":"Province"),e};return n.propTypes={children:O().node,index:O().number.isRequired,value:O().number.isRequired},(0,a.jsxs)("div",{children:[(0,a.jsx)(N.Z,{isOpen:ee.isOpen,maxWidth:"xs",openButtonText:null,title:ee.title,contentText:ee.msg,loading:ee.loading,modalCancelHandlerCB:function(){ee.savesuccess?ce():ae()},modalConfirmHandlerCB:function(){ee.savesuccess?ce():re()}}),(0,a.jsx)(U.Z,{open:Q,pdfPreview:te,error:j.error,loading:j.loading,toggleViewerOpen:le}),(0,a.jsxs)(L.ZP,{container:!0,sx:F.Z.container,children:[(0,a.jsxs)(R.Z,{sx:F.Z.headerText,children:[(0,a.jsxs)(R.Z,{children:[(0,a.jsx)(T.Z,{variant:"h5",children:"Regional Seasonal Climate Outlook and Advisory Crop Recommendations Bulletin"}),(0,a.jsxs)("p",{children:["Create ",(0,a.jsx)("strong",{children:"Seasonal"})," crop recommendations bulletins. Finalized bulletins will be automatically uploaded to the site for public download."]})]}),(0,a.jsx)(R.Z,{children:(0,a.jsx)(Z.Z,{"aria-label":"exit",size:"medium",children:(0,a.jsx)(w.default,{href:"/admin/bulletins/crops",passHref:!0,children:(0,a.jsx)(S.Z,{fontSize:"inherit"})})})})]}),(0,a.jsxs)(L.ZP,{item:!0,sx:F.Z.item,xs:12,lg:4,children:[(0,a.jsx)(T.Z,{variant:"h6",children:"Selection Options"}),(0,a.jsx)(k.Z,{disablePortal:!0,id:"province",value:j.sel_province,disabled:0===V.length||f,options:V,sx:F.Z.autocomplete,size:"small",PaperComponent:z.Z,renderInput:function(e){return(0,a.jsx)(I.Z,G({},e,{label:ue()}))},isOptionEqualToValue:function(e,n){return e.label===n.label},onChange:function(e,n){return Y(e,G({},n,{from:"province"}))}}),(0,a.jsx)(k.Z,{disablePortal:!0,id:"municipality",value:j.sel_municipality,disabled:0===X.length||f,options:X,sx:F.Z.autocomplete,size:"small",PaperComponent:z.Z,renderInput:function(e){return(0,a.jsx)(I.Z,G({},e,{label:null===j.sel_municipality?"Select a municipality":"Municipality"}))},isOptionEqualToValue:function(e,n){return e.label===n.label},onChange:function(e,n){return Y(e,G({},n,{from:"municipality"}))}}),(0,a.jsx)(k.Z,{disablePortal:!0,id:"crop",value:j.sel_crop,disabled:0===$.length||f,options:$,sx:F.Z.autocomplete,size:"small",PaperComponent:z.Z,renderInput:function(e){return(0,a.jsx)(I.Z,G({},e,{label:null===j.sel_crop?"Select a crop type":"Crop"}))},isOptionEqualToValue:function(e,n){return e.label===n.label},getOptionDisabled:function(e){return e.disabled},onChange:function(e,n){return Y(e,G({},n,{from:"crop"}))}}),(0,a.jsx)(k.Z,{disablePortal:!0,id:"month",value:j.sel_month,disabled:f||0===K.length||0===$.length||null===j.sel_crop,options:K,sx:F.Z.autocomplete,size:"small",PaperComponent:z.Z,renderInput:function(e){return(0,a.jsx)(I.Z,G({},e,{label:null===j.sel_month?"Select a Month":"Month"}))},isOptionEqualToValue:function(e,n){return e.label===n.label},getOptionDisabled:function(e){return e.disabled},onChange:function(e,n){return Y(e,G({},n,{from:"month"}))}}),(0,a.jsxs)(C.Z,{disableElevation:!0,size:"small","aria-label":"outlined button controls group",disabled:f||null===j.sel_municipality||null===j.sel_crop||null===j.sel_month,sx:{marginTop:"16px",float:"right"},children:[(0,a.jsx)(A.Z,{variant:"outlined",onClick:se,children:"Reset"}),(0,a.jsx)(A.Z,{variant:"contained",onClick:oe,children:"Generate"})]})]}),(0,a.jsx)(L.ZP,{item:!0,sx:F.Z.item,xs:12,lg:8,children:(0,a.jsxs)(R.Z,{sx:F.Z.selectionSummary,children:[(0,a.jsx)(T.Z,{variant:"h6",children:"Selection Summary"}),null===j.sel_province?(0,a.jsxs)(R.Z,{sx:F.Z.welcome,children:[(0,a.jsx)(E.default,{unoptimized:!0,src:(0,D.assetPrefixer)("images/icons/finance.svg"),height:85,width:85,loader:D.imageLoader,alt:"Empty data"}),(0,a.jsxs)(R.Z,{sx:{marginTop:"16px"},children:[(0,a.jsx)(T.Z,{variant:"subtitle2",children:"Crop Recommendations PDF Bulletins Creator"}),(0,a.jsx)(T.Z,{variant:"subtitle2",children:"Please select a province to start."})]})]}):(0,a.jsx)(R.Z,{sx:F.Z.summary,children:H.map((function(e,n){return(0,a.jsxs)("div",{children:[(0,a.jsxs)(T.Z,{variant:"subtitle2",style:{display:"inline-block"},children:[e.label,": \xa0"]}),(0,a.jsx)(T.Z,{variant:"body2",style:{display:"inline-block"},children:null!==j[e.key]?["sel_stage","sel_activity"].includes(e.key)?j[e.key].map((function(n,t){return"".concat(n.label).concat(t<j[e.key].length-1?", ":"")})):j[e.key].label:""})]},"selected-".concat(n))}))}),""!==j.error&&(0,a.jsx)(T.Z,{variant:"caption",sx:{color:"red"},children:j.error})]})})]}),(0,a.jsxs)(L.ZP,{container:!0,sx:F.Z.container,gap:3,style:{marginTop:"24px"},children:[(0,a.jsxs)(L.ZP,{item:!0,sx:F.Z.item,xs:12,lg:12,children:[(0,a.jsxs)(R.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)(T.Z,{variant:"h6",children:"Crop Recommendations"}),(0,a.jsx)(P.Z,{size:24,color:"primary",sx:{display:j.loading?"block":"none"}})]}),J.length>0&&(0,a.jsxs)(R.Z,{children:[(0,a.jsxs)(R.Z,{sx:{display:{md:"block",lg:"flex"}},children:[(0,a.jsxs)(T.Z,{variant:"h5",sx:{display:0===j.sel_activity.length?"none":"block",flexGrow:{xs:12,sm:3}},children:[j.sel_crop.label," Recommendations"]}),(0,a.jsx)(R.Z,{sx:{flexGrow:{xs:12,sm:1}},children:null!==j.sel_month&&(0,a.jsxs)(R.Z,{sx:F.Z.conditionLegend,style:{color:[x.MW.ABOVE_NORMAL.label,x.MW.WAY_BELOW_NORMAL.label].includes(j.sel_condition.label)?"#fff":"#000",backgroundColor:x.tN[j.sel_condition.label]},children:[(0,a.jsx)(T.Z,{variant:"subtitle2",children:"Rainfall Condition"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:j.sel_month.label})," \xa0",(0,a.jsxs)("span",{children:[j.sel_condition.format," ","(",j.sel_condition.id,"%)"]})]})]})})]}),(0,a.jsxs)(R.Z,{sx:{width:"100%",marginTop:{xs:"85px",lg:"0px"}},children:[(0,a.jsx)(R.Z,{sx:{borderBottom:1,borderColor:"divider"},children:(0,a.jsxs)(B.Z,{value:u,onChange:function(e,n){d(n)},"aria-label":"basic tabs example",children:[(0,a.jsx)(W.Z,G({label:"PDF FORM"},t(0))),(0,a.jsx)(W.Z,G({label:"SMS FORM"},t(1)))]})}),(0,a.jsx)(n,{value:u,index:0,children:J.map((function(e,n){var t="Rice"===j.sel_crop.label?"(".concat(e.crop,")"):"";return(0,a.jsxs)(R.Z,{sx:F.Z.recSeasonal,children:[(0,a.jsxs)(T.Z,{variant:"h5",children:[e.stage," - ",e.activity," ",t]}),e.recommendations().map((function(e,t){return e.ul?(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:e.id}),e.subs.length>0&&(0,a.jsx)("ul",{children:e.subs.map((function(e,t){return(0,a.jsx)("li",{children:e},"sub-".concat(n,"-").concat(t))}))})]},"main-".concat(n,"-").concat(t)):(0,a.jsx)("p",{children:e.id},"main-".concat(n,"-").concat(t))}))]},"rec-".concat(n))}))}),(0,a.jsx)(n,{value:u,index:1,children:ne})]})]})]}),(0,a.jsxs)(R.Z,{sx:{marginBottom:"16px",width:"100%",display:J.length>0?"block":"none"},children:[(0,a.jsx)("br",{}),(0,a.jsx)(M.Z,{}),(0,a.jsx)("br",{}),(""!==j.error||""!==y)&&(0,a.jsxs)(T.Z,{variant:"caption",sx:{color:"red"},children:["Error: ",j.error||y]}),(0,a.jsxs)(C.Z,{size:"large","aria-label":"large button group",disabled:f,sx:{display:"flex",justifyContent:"flex-end",marginTop:"8px"},children:[(0,a.jsx)(w.default,{href:"/admin/bulletins/crops",passHref:!0,children:(0,a.jsx)(A.Z,{disabled:j.loading,children:"Cancel"})}),(0,a.jsxs)(A.Z,{disabled:j.loading,onClick:ie,children:[(0,a.jsx)("span",{style:{display:f?"none":"block"},children:"Preview"})," ","\xa0",(0,a.jsx)(P.Z,{size:24,color:"secondary",sx:{display:f?"block":"none"}})]}),(0,a.jsx)(A.Z,{variant:"contained",onClick:ae,disableElevation:!0,disabled:j.loading,children:"Save"})]})]})]})]})},Y=t(6383),X=t(7661);function $(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function K(e,n,t,r,i,a,l){try{var o=e[a](l),s=o.value}catch(c){return void t(c)}o.done?n(s):Promise.resolve(s).then(r,i)}function Q(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var a=e.apply(n,t);function l(e){K(a,r,i,l,o,"next",e)}function o(e){K(a,r,i,l,o,"throw",e)}l(void 0)}))}}function ee(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function ne(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){ee(e,n,t[n])}))}return e}function te(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,i,a=[],l=!0,o=!1;try{for(t=t.call(e);!(l=(r=t.next()).done)&&(a.push(r.value),!n||a.length!==n);l=!0);}catch(s){o=!0,i=s}finally{try{l||null==t.return||t.return()}finally{if(o)throw i}}return a}}(e,n)||ae(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function re(e){return function(e){if(Array.isArray(e))return $(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ae(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ie=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function ae(e,n){if(e){if("string"===typeof e)return $(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?$(e,n):void 0}}var le={sel_province:null,sel_municipality:null,sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null,sel_condition:{id:0,from:"weather_condition",label:x.MW.WAY_BELOW_NORMAL.label},loading:!1,error:"",success:""},oe={url:"",filename:""};var se=!0,ce=(0,y.Z)((function(e){var n=te((0,f.ky)(d.o.STATIC_RECOMMENDATIONS,"data"),2),t=n[0],r=n[1],y=(0,f.m$)(u.M.WEATHER_FORECASTS,"bicol",u.M.SUB_SEASONAL,"name"),_=y.documents,j=y.loading,O=(0,l.useState)([]),S=O[0],Z=O[1],w=(0,l.useState)([]),E=w[0],k=w[1],R=(0,l.useState)([]),P=R[0],A=R[1],C=(0,l.useState)([]),M=C[0],L=C[1],N=(0,l.useState)([]),I=N[0],T=N[1],B=(0,l.useState)({}),W=B[0],D=B[1],z=(0,l.useState)(le),U=z[0],F=z[1],V=(0,l.useState)([]),G=V[0],q=V[1],H=(0,l.useState)([]),$=H[0],K=H[1],ae=(0,l.useState)(oe),se=ae[0],ce=ae[1],ue=(0,l.useState)([]),de=ue[0],pe=ue[1],fe=(0,l.useState)(!1),me=fe[0],be=fe[1],ve=(0,l.useState)(g.BF),he=ve[0],xe=ve[1],ge=(0,l.useState)(""),ye=ge[0],_e=ge[1],je=(0,o.v9)((function(e){return e.dashboard.reportType})),Oe=(0,l.useRef)(!1),Se=(0,o.I0)(),Ze=(0,o.v9)((function(e){return e.reports})),we=Ze.report,Ee=Ze.status;(0,l.useEffect)((function(){return Oe.current=!0,function(){Oe.current=!1}}),[]),(0,l.useEffect)((function(){Se((0,b.s_)())}),[Se]),(0,l.useEffect)((function(){Ee===h.G.FULLFILLED&&null!==we&&Oe.current&&xe((function(e){return ne({},e,{msg:"Success! Bulletin report created.",loading:!1,savesuccess:!0,docId:we.id})}))}),[Ee,we]),(0,l.useEffect)((function(){if(e.municipalities.length>0&&!j&&!r){var n={};_.forEach((function(e){var t=e.name.split("_").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join(" ");n[t]={},e.months.forEach((function(e){var r=Object.values(x.MW).find((function(n){return n.label===e.con}));n[t][e.mo]={label:e.con,format:r.sync,val:e.val}}))}));var t=[];_[0].mos.forEach((function(e){t.push({id:x.re[e.toUpperCase()].code,label:x.re[e.toUpperCase()].format,disabled:!1})}));var i={},a=[];e.municipalities.forEach((function(e,n){void 0===i[e.province]?(a.push({id:n,label:e.province}),i[e.province]=[{id:0,label:e.name}]):i[e.province].push({id:i[e.province].length,label:e.name})})),Oe.current&&(k(i),Z(a),pe(t),D(n))}}),[e.municipalities,_,j,r]);var ke=function(){var e=Q(i().mark((function e(n,t){var r,a,l,o,u,d,p,f,m,b,v,h,g,y,_,j,O,S;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.from,a=t.label,n&&n.preventDefault(),T([]),ce(oe),!(["cropstage","activity"].includes(r)?Object.keys(t).length>1:Object.keys(t).includes("id"))){e.next=63;break}e.t0=r,e.next="province"===e.t0?9:"municipality"===e.t0?13:"crop"===e.t0?44:"month"===e.t0?51:60;break;case 9:return F(ne({},U,{sel_province:t,sel_municipality:null,sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null})),q(E[a]),K([]),e.abrupt("break",61);case 13:return l=[],e.prev=14,F(ne({},U,{loading:!0,error:""})),e.next=18,(0,c.$K)(U.sel_province.label,a);case 18:o=e.sent,((l=o.map((function(e){return e.crop})).filter((function(e,n,t){return t.indexOf(e)===n}))).includes("Rainfed Rice")||l.includes("Irrigated Rice"))&&l.push("Rice"),Oe.current&&A((function(e){return o})),e.next=27;break;case 24:e.prev=24,e.t1=e.catch(14),F((function(n){return ne({},n,{loading:!1,error:e.t1.message})}));case 27:if(0!==l.length){e.next=30;break}return F((function(e){return ne({},e,{loading:!1,error:"There was an error loading data."})})),e.abrupt("return");case 30:return e.prev=30,e.next=33,(0,s.OP)(U.sel_province.label,a);case 33:u=e.sent,d=[],(p=u.map((function(e){return e.crop})).filter((function(e,n,t){return t.indexOf(e)===n}))).forEach((function(e,n){d.push({id:n,label:e,disabled:!l.includes(e)})})),Oe.current&&(f=0===p.length?{id:"novalues",label:"No crop types for ".concat(a)}:null,F(ne({},U,{sel_municipality:t,sel_crop:f,sel_stage:[],sel_activity:[],sel_month:null,loading:!1,error:""})),K((function(e){return d})),L((function(e){return u}))),e.next=43;break;case 40:e.prev=40,e.t2=e.catch(30),F((function(n){return ne({},n,{loading:!1,error:e.t2.message})}));case 43:return e.abrupt("break",61);case 44:return F(ne({},U,{sel_crop:t,sel_stage:[],sel_activity:[],sel_month:null})),m=[],M.filter((function(e){return e.crop===a&&e.province===U.sel_province.label&&e.municipality===U.sel_municipality.label})).forEach((function(e){de.forEach((function(n){""===e[n.id]||m.includes(n.id)||m.push(n.id)}))})),b=re(de),de.forEach((function(e,n){b[n].disabled=!m.includes(e.id)})),pe(b),e.abrupt("break",61);case 51:return v=W[U.sel_province.label][t.id],h=v.label,g=v.val,y=v.format,_=[],j=[],M.forEach((function(e,n){var r=Object.values(x.re).find((function(e){return e.format===t.label})).code;if(""!==e[r]&&e.crop===U.sel_crop.label)for(var i=function(e){a[e].length>0&&!_.includes(a[e])&&(_.push(a[e]),P.filter((function(n){return n.stage===x.MZ[a[e].toUpperCase()]&&("Rice"===U.sel_crop.label?["Irrigated Rice","Rainfed Rice"].includes(n.crop):n.crop===U.sel_crop.label)})).map((function(e){return e.activity})).filter((function(e,n,t){return t.indexOf(e)==n})).length>0&&j.push({id:j.length,label:x.MZ[a[e].toUpperCase()]}))},a=e[r].split(","),l=0;l<a.length;l+=1)i(l)})),O=P.filter((function(e){return j.map((function(e){return e.label})).includes(e.stage)&&("Rice"===U.sel_crop.label?["Irrigated Rice","Rainfed Rice"].includes(e.crop):e.crop===U.sel_crop.label)})).map((function(e){return{activity:e.activity,stage:e.stage}})).filter((function(e,n,t){return t.map((function(e){return e.activity})).indexOf(e.activity)===n})),S=O.reduce((function(e,n,t){return e.includes(n.activity)||e.push({id:t,label:n.activity,stage:n.stage}),re(e)}),[]),F((function(e){return ne({},e,{sel_month:t,sel_stage:j,sel_activity:S,sel_condition:{id:g,format:y,label:h}})})),_e((function(e){return(0,X.smsWriter)({type:X.SMS_TYPE.SEASONAL,replacements:ee({},X.REPLACE_KEYS.SEASONAL.MONTH,X.MONTHS_TAGALOG[t.id])})})),e.abrupt("break",61);case 60:return e.abrupt("break",61);case 61:e.next=64;break;case 63:"province"===r?Re():"municipality"===r?(F(ne({},U,{sel_municipality:null,sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null})),K([])):"crop"===r?F(ne({},U,{sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null})):"month"===r&&F(ne({},U,{sel_month:null,sel_stage:[],sel_activity:[]}));case 64:case"end":return e.stop()}}),e,null,[[14,24],[30,40]])})));return function(n,t){return e.apply(this,arguments)}}(),Re=function(){F(le),T([]),q([]),K([])},Pe=function(){var n=Q(i().mark((function n(){var t,r,a;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=Object.values(x.re).find((function(e){return e.format===U.sel_month.label})).code,xe(ne({},he,{loading:!0,msg:"Saving report..."}));try{r={region:"bicol",province:U.sel_province.label,municipality:U.sel_municipality.label,crop:U.sel_crop.label,month:t,stages:U.sel_stage.map((function(e){return e.label})),activities:U.sel_activity.map((function(e){return e.label})),operation:"create"},Se((0,v.Br)(r)).unwrap().then((function(){je!==g.Ry.SEASONAL&&(Se((0,m.uq)(g.Ry.SEASONAL)),Se((0,v.RC)({uid:e.user.uid,type:g.Ry.SEASONAL})))})).catch((function(e){Oe.current&&xe((function(n){return ne({},n,{msg:e.message,loading:!1,savesuccess:!1,docId:null})}))}))}catch(i){a="",void 0!==i.response&&(a=void 0!==i.response.data&&"[object Blob]"===ie(i.response.data)?i.response.data:""),""===a&&(a=i.message)}case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),Ae=function(){var e=Q(i().mark((function e(){var n,t,r,a,l,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===se.url){e.next=3;break}return be(!0),e.abrupt("return");case 3:return F((function(e){return ne({},e,{loading:!0,error:"",success:""})})),n=Object.values(x.re).find((function(e){return e.format===U.sel_month.label})).code,e.prev=5,t={region:"bicol",province:U.sel_province.label,municipality:U.sel_municipality.label,crop:U.sel_crop.label,month:n,stages:U.sel_stage.map((function(e){return e.label})),activities:U.sel_activity.map((function(e){return e.label})),operation:"preview"},be(!0),F((function(e){return ne({},e,{loading:!0,error:""})})),e.next=11,(0,p.pl)(t);case 11:r=e.sent,a=new Blob([r],{type:"application/pdf"}),(l={}).href=URL.createObjectURL(a),l.download="".concat(U.sel_province.label,"_").concat(U.sel_municipality.label,"-").concat(U.sel_crop.label,".pdf"),ce((function(e){return ne({},e,{url:l.href,filename:l.download})})),F((function(e){return ne({},e,{loading:!1,success:"Bulletin preview created."})})),e.next=26;break;case 20:e.prev=20,e.t0=e.catch(5),o="",void 0!==e.t0.response&&(o=void 0!==e.t0.response.data&&"[object Blob]"===ie(e.t0.response.data)?e.t0.response.data:""),""===o&&(o=e.t0.message),F((function(e){return ne({},e,{loading:!1,error:o})}));case 26:case"end":return e.stop()}}),e,null,[[5,20]])})));return function(){return e.apply(this,arguments)}}();return(0,a.jsx)(Y.Z,{loading:e.loading,user:e.user,onBtnLogoutClick:e.onBtnLogoutClick,accLevel:x.DW.ADMIN,children:(0,a.jsx)(J,{sel_options:U,open:me,message:he,smstext:ye,provinces:S,recommendations:I,optsmunicipalities:G,optscrops:$,optsmonths:de,pdfPreview:se,onSelectItemChange:ke,handlePreview:Ae,handleSave:Pe,togglePrompt:function(){xe((function(e){return ne({},g.BF,{isOpen:!e.isOpen})}))},toggleViewerOpen:function(){be((function(e){return!e}))},resetSelections:Re,generateRecommendations:function(){if(0!==U.sel_activity.length){var e=P.filter((function(e){return U.sel_activity.map((function(e){return e.label})).includes(e.activity)&&U.sel_stage.map((function(e){return e.label})).includes(e.stage)&&("Rice"===U.sel_crop.label?["Irrigated Rice","Rainfed Rice"].includes(e.crop):e.crop===U.sel_crop.label)})).map((function(e){return{province:e.province,municipality:e.municipality,crop:e.crop,stage:e.stage,activity:e.activity,recommendations:function(){switch(U.sel_condition.label){case x.MW.BELOW_NORMAL.label:case x.MW.NEAR_NORMAL.label:return JSON.parse(e.normal).map((function(e){return{id:t.mains.find((function(n){return n.id===e.id})).description,ul:e.ul,subs:e.subs.map((function(e){return t.subs.find((function(n){return n.id===e})).description}))}}));case x.MW.ABOVE_NORMAL.label:return JSON.parse(e.wetter).map((function(e){return{id:t.mains.find((function(n){return n.id===e.id})).description,ul:e.ul,subs:e.subs.map((function(e){return t.subs.find((function(n){return n.id===e})).description}))}}));case x.MW.WAY_BELOW_NORMAL.label:return JSON.parse(e.drier).map((function(e){return{id:t.mains.find((function(n){return n.id===e.id})).description,ul:e.ul,subs:e.subs.map((function(e){return t.subs.find((function(n){return n.id===e})).description}))}}))}},smsRecommendations:function(){var n="".concat(function(e){var n="";switch(e){case x.MW.WAY_BELOW_NORMAL.label:n="drier";break;case x.MW.BELOW_NORMAL.label:case x.MW.NEAR_NORMAL.label:n="normal";break;case x.MW.ABOVE_NORMAL.label:n="wetter"}return n}(U.sel_condition.label),"_sms");return void 0!==e[n]?t.sms.find((function(t){return t.id===e[n]})).description:""}}}));T(e)}}})})}))},7682:function(e,n,t){"use strict";t.d(n,{ky:function(){return p},Kx:function(){return f},m$:function(){return m},tl:function(){return b}});var r=t(4051),i=t.n(r),a=t(7294),l=t(5321),o=t(5152);function s(e,n,t,r,i,a,l){try{var o=e[a](l),s=o.value}catch(c){return void t(c)}o.done?n(s):Promise.resolve(s).then(r,i)}function c(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var a=e.apply(n,t);function l(e){s(a,r,i,l,o,"next",e)}function o(e){s(a,r,i,l,o,"throw",e)}l(void 0)}))}}function u(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function d(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){u(e,n,t[n])}))}return e}function p(e,n){var t=(0,a.useState)(null),r=t[0],s=t[1],u=(0,a.useState)(!0),d=u[0],p=u[1],f=(0,a.useState)(""),m=f[0],b=f[1],v=(0,a.useRef)(!0);return(0,a.useEffect)((function(){var t=function(){var t=c(i().mark((function t(){var r,a;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=(0,l.JU)(o.db,e,n),t.next=4,(0,l.QT)(r);case 4:(a=t.sent).exists()&&v.current&&(s(a.data()),p(!1)),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),b(t.t0.message),p(!1);case 12:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(){return t.apply(this,arguments)}}();return t(),function(){return v.current=!1}}),[e,n]),[r,d,m]}function f(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=(0,a.useState)([]),s=r[0],u=r[1],p=(0,a.useState)(!0),f=p[0],m=p[1],b=(0,a.useState)(""),v=b[0],h=b[1],x=(0,a.useRef)(!0);return(0,a.useEffect)((function(){var r=function(){var r=c(i().mark((function r(){var a,s,c;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,a=(0,l.hJ)(o.db,e),s=t||(0,l.IO)(a,(0,l.Xo)(n,"asc")),r.next=5,(0,l.PL)(s);case 5:c=r.sent,x.current&&(u(c.docs.map((function(e){return d({},e.data())}))),m(!1)),r.next=13;break;case 9:r.prev=9,r.t0=r.catch(0),h(r.t0.message),m(!1);case 13:case"end":return r.stop()}}),r,null,[[0,9]])})));return function(){return r.apply(this,arguments)}}();return r(),function(){return x.current=!1}}),[e,n,t]),{documents:s,loading:f,error:v}}function m(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",s=(0,a.useState)([]),u=s[0],p=s[1],f=(0,a.useState)(!0),m=f[0],b=f[1],v=(0,a.useState)(""),h=v[0],x=v[1],g=(0,a.useRef)(!0);return(0,a.useEffect)((function(){var a=function(){var a=c(i().mark((function a(){var s,c;return i().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,s=(0,l.IO)((0,l.hJ)(o.db,e,n,t),(0,l.Xo)(r)),i.next=4,(0,l.PL)(s);case 4:c=i.sent,g.current&&(p(c.docs.map((function(e){return d({},e.data())}))),b(!1)),i.next=12;break;case 8:i.prev=8,i.t0=i.catch(0),x(i.t0.message),b(!1);case 12:case"end":return i.stop()}}),a,null,[[0,8]])})));return function(){return a.apply(this,arguments)}}();return a(),function(){return g.current=!1}}),[e,n,t,r]),{documents:u,loading:m,error:h}}function b(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",s=arguments.length>4?arguments[4]:void 0,u=(0,a.useState)([]),p=u[0],f=u[1],m=(0,a.useState)(!0),b=m[0],v=m[1],h=(0,a.useState)(""),x=h[0],g=h[1],y=(0,a.useRef)(!0);return(0,a.useEffect)((function(){var a=function(){var a=c(i().mark((function a(){var c,u;return i().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,c=(0,l.hJ)(o.db,e,n,t),""!==r&&(c=(0,l.IO)(c,(0,l.Xo)(r))),s&&(c=(0,l.IO)(c,(0,l.b9)(s))),i.next=6,(0,l.PL)(c);case 6:u=i.sent,y.current&&(f(u.docs.map((function(e){return d({},e.data())}))),v(!1)),i.next=14;break;case 10:i.prev=10,i.t0=i.catch(0),g(i.t0.message),v(!1);case 14:case"end":return i.stop()}}),a,null,[[0,10]])})));return function(){return a.apply(this,arguments)}}();return a(),function(){return y.current=!1}}),[e,n,t,r,s]),{documents:p,loading:b,error:x}}}},function(e){e.O(0,[6284,2866,9964,1704,1903,7823,6295,4039,2882,6572,1050,8041,9774,2888,179],(function(){return n=108,e(e.s=n);var n}));var n=e.O();_N_E=n}]);