(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[970],{108:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bulletins/crops/seasonal/create",function(){return t(8289)}])},1033:function(e,n,t){"use strict";t.d(n,{Z:function(){return c}});var r=t(5893),i=t(5675),l=t(7357),a=t(5861),o=t(120),s={container:{textAlign:"center",minHeight:"200px",width:"100%",border:"4px solid rgba(0, 0, 0, 0.11)",borderRadius:function(e){return e.spacing(2)},color:function(e){return e.palette.text.secondary},borderStyle:"dashed",padding:function(e){return e.spacing(2)},marginTop:function(e){return e.spacing(4)}}};var c=function(e){var n=e.message,t=void 0===n?"Failed to load data":n,c=e.style,u=void 0===c?{}:c;return(0,r.jsxs)(l.Z,{sx:s.container,style:u,children:[(0,r.jsx)(i.default,{unoptimized:!0,src:(0,o.assetPrefixer)("images/icons/empty-state-light.svg"),height:120,width:120,loader:o.imageLoader,alt:"Empty data"}),(0,r.jsx)(a.Z,{variant:"subtitle1",children:t})]})}},3080:function(e,n,t){"use strict";var r=t(5893),i=t(7357),l=t(8456);n.Z=function(e){var n=e.text,t=void 0===n?"":n,a=e.size,o=void 0===a?24:a,s=e.children;return(0,r.jsxs)(i.Z,{sx:{width:"100%",textAlign:"center",height:"20vh"},children:[(0,r.jsxs)(i.Z,{sx:{width:"100%",textAlign:"center",marginTop:function(e){return e.spacing(12)},marginBottom:"32px",display:"flex",justifyContent:"center"},children:[(0,r.jsx)("span",{children:""!==t?t:"Loading..."})," \xa0",(0,r.jsx)(l.Z,{size:o})]}),s]})}},8289:function(e,n,t){"use strict";t.r(n),t.d(n,{__N_SSG:function(){return pe},default:function(){return fe}});var r=t(4051),i=t.n(r),l=t(5893),a=t(7294),o=t(9473),s=t(2848),c=t(1652),u=t(560),d=t(4680),p=t(8152),f=t(7682),b=t(3063),m=t(2671),h=t(1690),v=t(901),x=t(7426),g=t(3059),y=t(1163),_=t(5697),j=t.n(_),Z=t(1023),O=t(3946),w=t(1664),S=t(5675),R=t(6295),k=t(7357),E=t(8456),C=t(1057),A=t(6863),P=t(657),M=t(1425),L=t(6580),N=t(7645),B=t(7720),I=t(6886),W=t(3501),T=t(1903),z=t(5861),D=t(8409),F=t(44),U=t(120),V=t(1033),G=t(3080),q=t(9758),H=t(2757);function Y(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function J(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){Y(e,n,t[n])}))}return e}function $(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var K=[{key:"sel_province",label:"Province"},{key:"sel_municipality",label:"Municipality"},{key:"sel_crop",label:"Crop"},{key:"sel_month",label:"Months"},{key:"sel_stage",label:"Crop Stages"},{key:"sel_activity",label:"Activities"}];var X=function(e){var n=function(e){var n=e.children,t=e.value,r=e.index,i=$(e,["children","value","index"]);return(0,l.jsx)("div",J({role:"tabpanel",hidden:t!==r,id:"simple-tabpanel-".concat(r),"aria-labelledby":"simple-tab-".concat(r)},i,{children:t===r&&(0,l.jsx)(k.Z,{sx:{p:3},children:n})}))},t=function(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}},r=(0,a.useRef)(!0),i=(0,y.useRouter)(),s=(0,o.I0)(),c=(0,a.useState)(0),u=c[0],d=c[1],p=(0,a.useState)(!1),f=p[0],b=p[1],h=(0,o.v9)((function(e){return e.reports})),g=h.status,_=h.error,Y=e.sel_options,X=e.provinces,Q=e.recommendations,ee=e.onSelectItemChange,ne=e.optsmunicipalities,te=e.optscrops,re=e.optsmonths,ie=e.open,le=e.pdfPreview,ae=e.handleSave,oe=e.handlePreview,se=e.toggleViewerOpen,ce=e.generateRecommendations,ue=e.resetSelections;(0,a.useEffect)((function(){return r.current=!0,function(){r.current=!1}}),[]),(0,a.useEffect)((function(){b(Y.loading||g===v.G.PENDING)}),[Y.loading,g]);var de=function(){s((0,m.s_)()),i.push("/admin/bulletins/crops/report/view/?docId=".concat(ie.docId))},pe=function(){var e="Loading...";return X.length>0&&(e=null===Y.sel_province?"Select a province":"Province"),e};return n.propTypes={children:j().node,index:j().number.isRequired,value:j().number.isRequired},(0,l.jsxs)("div",{children:[(0,l.jsx)(W.Z,{isOpen:ie.savesuccess,maxWidth:"xs",openButtonText:null,title:"Success",contentText:"Success! Bulletin report created.",modalConfirmHandlerCB:de,modalCancelHandlerCB:de}),(0,l.jsxs)(P.Z,{open:ie.preview,maxWidth:"lg",fullWidth:!0,"aria-labelledby":"data-saved-success","aria-describedby":"alert-dialog-description",children:[(0,l.jsx)(N.Z,{id:"data-saved-success",children:""!==le.filename?"Bulletin Preview - ".concat(le.filename):"Bulletin Preview"}),(0,l.jsx)(L.Z,{sx:{padding:0,overflow:"hidden"},children:(0,l.jsx)(k.Z,{id:"alert-dialog-description",children:Y.loading?(0,l.jsx)("div",{style:{width:"100%",height:"90vh",textAlign:"center"},children:(0,l.jsx)(G.Z,{text:"Loading Preview...",children:(0,l.jsx)(S.default,{unoptimized:!0,src:(0,U.assetPrefixer)("images/icons/data-processing-128.png"),height:100,width:100,loader:U.imageLoader,alt:"Loading Preview"})})}):""!==Y.error?(0,l.jsx)("div",{style:{width:"100%",height:"100vh"},children:(0,l.jsx)(V.Z,{message:Y.error})}):(0,l.jsx)("embed",{src:le.url,style:{width:"100%",height:"70vh"}})})}),(0,l.jsx)(M.Z,{children:(0,l.jsx)(C.Z,{variant:"contained",onClick:se,autoFocus:!0,children:"OK"})})]}),(0,l.jsxs)(I.ZP,{container:!0,sx:H.Z.container,children:[(0,l.jsxs)(k.Z,{sx:H.Z.headerText,children:[(0,l.jsxs)(k.Z,{children:[(0,l.jsx)(z.Z,{variant:"h5",children:"Regional Seasonal Climate Outlook and Advisory Crop Recommendations Bulletin"}),(0,l.jsxs)("p",{children:["Create ",(0,l.jsx)("strong",{children:"Seasonal"})," crop recommendations bulletins. Finalized bulletins will be automatically uploaded to the site for public download."]})]}),(0,l.jsx)(k.Z,{children:(0,l.jsx)(O.Z,{"aria-label":"exit",size:"medium",children:(0,l.jsx)(w.default,{href:"/admin/bulletins/crops",passHref:!0,children:(0,l.jsx)(Z.Z,{fontSize:"inherit"})})})})]}),(0,l.jsxs)(I.ZP,{item:!0,sx:H.Z.item,xs:12,lg:4,children:[(0,l.jsx)(z.Z,{variant:"h6",children:"Selection Options"}),(0,l.jsx)(R.Z,{disablePortal:!0,id:"province",value:Y.sel_province,disabled:0===X.length||f,options:X,sx:H.Z.autocomplete,size:"small",PaperComponent:q.Z,renderInput:function(e){return(0,l.jsx)(T.Z,J({},e,{label:pe()}))},isOptionEqualToValue:function(e,n){return e.label===n.label},onChange:function(e,n){return ee(e,J({},n,{from:"province"}))}}),(0,l.jsx)(R.Z,{disablePortal:!0,id:"municipality",value:Y.sel_municipality,disabled:0===ne.length||f,options:ne,sx:H.Z.autocomplete,size:"small",PaperComponent:q.Z,renderInput:function(e){return(0,l.jsx)(T.Z,J({},e,{label:null===Y.sel_municipality?"Select a municipality":"Municipality"}))},isOptionEqualToValue:function(e,n){return e.label===n.label},onChange:function(e,n){return ee(e,J({},n,{from:"municipality"}))}}),(0,l.jsx)(R.Z,{disablePortal:!0,id:"crop",value:Y.sel_crop,disabled:0===te.length||f,options:te,sx:H.Z.autocomplete,size:"small",PaperComponent:q.Z,renderInput:function(e){return(0,l.jsx)(T.Z,J({},e,{label:null===Y.sel_crop?"Select a crop type":"Crop"}))},isOptionEqualToValue:function(e,n){return e.label===n.label},getOptionDisabled:function(e){return e.disabled},onChange:function(e,n){return ee(e,J({},n,{from:"crop"}))}}),(0,l.jsx)(R.Z,{disablePortal:!0,id:"month",value:Y.sel_month,disabled:f||0===re.length||0===te.length||null===Y.sel_crop,options:re,sx:H.Z.autocomplete,size:"small",PaperComponent:q.Z,renderInput:function(e){return(0,l.jsx)(T.Z,J({},e,{label:null===Y.sel_month?"Select a Month":"Month"}))},isOptionEqualToValue:function(e,n){return e.label===n.label},getOptionDisabled:function(e){return e.disabled},onChange:function(e,n){return ee(e,J({},n,{from:"month"}))}}),(0,l.jsxs)(A.Z,{disableElevation:!0,size:"small","aria-label":"outlined button controls group",disabled:f||null===Y.sel_municipality||null===Y.sel_crop||null===Y.sel_month,sx:{marginTop:"16px",float:"right"},children:[(0,l.jsx)(C.Z,{variant:"outlined",onClick:ue,children:"Reset"}),(0,l.jsx)(C.Z,{variant:"contained",onClick:ce,children:"Generate"})]})]}),(0,l.jsx)(I.ZP,{item:!0,sx:H.Z.item,xs:12,lg:8,children:(0,l.jsxs)(k.Z,{sx:H.Z.selectionSummary,children:[(0,l.jsx)(z.Z,{variant:"h6",children:"Selection Summary"}),null===Y.sel_province?(0,l.jsxs)(k.Z,{sx:H.Z.welcome,children:[(0,l.jsx)(S.default,{unoptimized:!0,src:(0,U.assetPrefixer)("images/icons/finance.svg"),height:85,width:85,loader:U.imageLoader,alt:"Empty data"}),(0,l.jsxs)(k.Z,{sx:{marginTop:"16px"},children:[(0,l.jsx)(z.Z,{variant:"subtitle2",children:"Crop Recommendations PDF Bulletins Creator"}),(0,l.jsx)(z.Z,{variant:"subtitle2",children:"Please select a province to start."})]})]}):(0,l.jsx)(k.Z,{sx:H.Z.summary,children:K.map((function(e,n){return(0,l.jsxs)("div",{children:[(0,l.jsxs)(z.Z,{variant:"subtitle2",style:{display:"inline-block"},children:[e.label,": \xa0"]}),(0,l.jsx)(z.Z,{variant:"body2",style:{display:"inline-block"},children:null!==Y[e.key]?["sel_stage","sel_activity"].includes(e.key)?Y[e.key].map((function(n,t){return"".concat(n.label).concat(t<Y[e.key].length-1?", ":"")})):Y[e.key].label:""})]},"selected-".concat(n))}))}),""!==Y.error&&(0,l.jsx)(z.Z,{variant:"caption",sx:{color:"red"},children:Y.error})]})})]}),(0,l.jsxs)(I.ZP,{container:!0,sx:H.Z.container,gap:3,style:{marginTop:"24px"},children:[(0,l.jsxs)(I.ZP,{item:!0,sx:H.Z.item,xs:12,lg:12,children:[(0,l.jsxs)(k.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsx)(z.Z,{variant:"h6",children:"Crop Recommendations"}),(0,l.jsx)(E.Z,{size:24,color:"primary",sx:{display:Y.loading?"block":"none"}})]}),Q.length>0&&(0,l.jsxs)(k.Z,{children:[(0,l.jsxs)(k.Z,{sx:{display:{md:"block",lg:"flex"}},children:[(0,l.jsxs)(z.Z,{variant:"h5",sx:{display:0===Y.sel_activity.length?"none":"block",flexGrow:{xs:12,sm:3}},children:[Y.sel_crop.label," Recommendations"]}),(0,l.jsx)(k.Z,{sx:{flexGrow:{xs:12,sm:1}},children:null!==Y.sel_month&&(0,l.jsxs)(k.Z,{sx:H.Z.conditionLegend,style:{color:[x.MW.ABOVE_NORMAL.label,x.MW.WAY_BELOW_NORMAL.label].includes(Y.sel_condition.label)?"#fff":"#000",backgroundColor:x.tN[Y.sel_condition.label]},children:[(0,l.jsx)(z.Z,{variant:"subtitle2",children:"Seasonal Weather Condition"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{children:Y.sel_month.label})," \xa0",(0,l.jsxs)("span",{children:[Y.sel_condition.format," ","(",Y.sel_condition.id,"%)"]})]})]})})]}),(0,l.jsxs)(k.Z,{sx:{width:"100%",marginTop:{xs:"85px",lg:"0px"}},children:[(0,l.jsx)(k.Z,{sx:{borderBottom:1,borderColor:"divider"},children:(0,l.jsxs)(D.Z,{value:u,onChange:function(e,n){d(n)},"aria-label":"basic tabs example",children:[(0,l.jsx)(F.Z,J({label:"PDF FORM"},t(0))),(0,l.jsx)(F.Z,J({label:"SMS FORM"},t(1)))]})}),(0,l.jsx)(n,{value:u,index:0,children:Q.map((function(e,n){var t="Rice"===Y.sel_crop.label?"(".concat(e.crop,")"):"";return(0,l.jsxs)(k.Z,{sx:H.Z.recSeasonal,children:[(0,l.jsxs)(z.Z,{variant:"h5",children:[e.stage," - ",e.activity," ",t]}),e.recommendations().map((function(e,t){return e.ul?(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:e.id}),e.subs.length>0&&(0,l.jsx)("ul",{children:e.subs.map((function(e,t){return(0,l.jsx)("li",{children:e},"sub-".concat(n,"-").concat(t))}))})]},"main-".concat(n,"-").concat(t)):(0,l.jsx)("p",{children:e.id},"main-".concat(n,"-").concat(t))}))]},"rec-".concat(n))}))}),(0,l.jsx)(n,{value:u,index:1,children:Q.reduce((function(e,n){return e+=n.smsRecommendations()+" "}),"")})]})]})]}),(0,l.jsxs)(k.Z,{sx:{marginBottom:"16px",width:"100%",display:Q.length>0?"block":"none"},children:[(0,l.jsx)("br",{}),(0,l.jsx)(B.Z,{}),(0,l.jsx)("br",{}),(""!==Y.error||""!==_)&&(0,l.jsxs)(z.Z,{variant:"caption",sx:{color:"red"},children:["Error: ",Y.error||_]}),(0,l.jsxs)(A.Z,{size:"large","aria-label":"large button group",disabled:f,sx:{display:"flex",justifyContent:"flex-end",marginTop:"8px"},children:[(0,l.jsx)(w.default,{href:"/admin/bulletins/crops",passHref:!0,children:(0,l.jsx)(C.Z,{disabled:Y.loading,children:"Cancel"})}),(0,l.jsxs)(C.Z,{disabled:Y.loading,onClick:oe,children:[(0,l.jsx)("span",{style:{display:f?"none":"block"},children:"Preview"})," ","\xa0",(0,l.jsx)(E.Z,{size:24,color:"secondary",sx:{display:f?"block":"none"}})]}),(0,l.jsx)(C.Z,{variant:"contained",onClick:ae,disableElevation:!0,disabled:Y.loading,children:"Save"})]})]})]})]})},Q=t(2530);function ee(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function ne(e,n,t,r,i,l,a){try{var o=e[l](a),s=o.value}catch(c){return void t(c)}o.done?n(s):Promise.resolve(s).then(r,i)}function te(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var l=e.apply(n,t);function a(e){ne(l,r,i,a,o,"next",e)}function o(e){ne(l,r,i,a,o,"throw",e)}a(void 0)}))}}function re(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function ie(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){re(e,n,t[n])}))}return e}function le(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,i,l=[],a=!0,o=!1;try{for(t=t.call(e);!(a=(r=t.next()).done)&&(l.push(r.value),!n||l.length!==n);a=!0);}catch(s){o=!0,i=s}finally{try{a||null==t.return||t.return()}finally{if(o)throw i}}return l}}(e,n)||se(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ae(e){return function(e){if(Array.isArray(e))return ee(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||se(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var oe=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function se(e,n){if(e){if("string"===typeof e)return ee(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?ee(e,n):void 0}}var ce={sel_province:null,sel_municipality:null,sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null,sel_condition:{id:0,from:"weather_condition",label:x.MW.WAY_BELOW_NORMAL.label},loading:!1,error:"",success:""},ue={url:"",filename:""},de={preview:!1,savesuccess:!1,docId:""};var pe=!0,fe=(0,g.Z)((function(e){var n=le((0,f.ky)(d.o.STATIC_RECOMMENDATIONS,"data"),2),t=n[0],r=n[1],g=(0,f.m$)(u.M.WEATHER_FORECASTS,"bicol",u.M.SUB_SEASONAL,"name"),y=g.documents,_=g.loading,j=(0,a.useState)([]),Z=j[0],O=j[1],w=(0,a.useState)([]),S=w[0],R=w[1],k=(0,a.useState)([]),E=k[0],C=k[1],A=(0,a.useState)([]),P=A[0],M=A[1],L=(0,a.useState)([]),N=L[0],B=L[1],I=(0,a.useState)({}),W=I[0],T=I[1],z=(0,a.useState)(ce),D=z[0],F=z[1],U=(0,a.useState)([]),V=U[0],G=U[1],q=(0,a.useState)([]),H=q[0],Y=q[1],J=(0,a.useState)(ue),$=J[0],K=J[1],ee=(0,a.useState)([]),ne=ee[0],re=ee[1],se=(0,a.useState)(de),pe=se[0],fe=se[1],be=(0,o.v9)((function(e){return e.dashboard.reportType})),me=(0,a.useRef)(!1),he=(0,o.I0)(),ve=(0,o.v9)((function(e){return e.reports})),xe=ve.report,ge=ve.status;(0,a.useEffect)((function(){return me.current=!0,function(){me.current=!1}}),[]),(0,a.useEffect)((function(){he((0,m.s_)())}),[he]),(0,a.useEffect)((function(){ge===v.G.FULLFILLED&&null!==xe&&fe(ie({},de,{savesuccess:!0,docId:xe.id}))}),[ge,xe]),(0,a.useEffect)((function(){if(e.municipalities.length>0&&!_&&!r){var n={};y.forEach((function(e){var t=e.name.split("_").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join(" ");n[t]={},e.months.forEach((function(e){var r=Object.values(x.MW).find((function(n){return n.label===e.con}));n[t][e.mo]={label:e.con,format:r.sync,val:e.val}}))}));var t=[];y[0].mos.forEach((function(e){t.push({id:x.re[e.toUpperCase()].code,label:x.re[e.toUpperCase()].format,disabled:!1})}));var i={},l=[];e.municipalities.forEach((function(e,n){void 0===i[e.province]?(l.push({id:n,label:e.province}),i[e.province]=[{id:0,label:e.name}]):i[e.province].push({id:i[e.province].length,label:e.name})})),me.current&&(R(i),O(l),re(t),T(n))}}),[e.municipalities,y,_,r]);var ye=function(){var e=te(i().mark((function e(n,t){var r,l,a,o,u,d,p,f,b,m,h,v,g,y,_,j,Z,O;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.from,l=t.label,n&&n.preventDefault(),B([]),K(ue),!(["cropstage","activity"].includes(r)?Object.keys(t).length>1:Object.keys(t).includes("id"))){e.next=62;break}e.t0=r,e.next="province"===e.t0?9:"municipality"===e.t0?13:"crop"===e.t0?44:"month"===e.t0?51:59;break;case 9:return F(ie({},D,{sel_province:t,sel_municipality:null,sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null})),G(S[l]),Y([]),e.abrupt("break",60);case 13:return a=[],e.prev=14,F(ie({},D,{loading:!0,error:""})),e.next=18,(0,c.$K)(D.sel_province.label,l);case 18:o=e.sent,((a=o.map((function(e){return e.crop})).filter((function(e,n,t){return t.indexOf(e)===n}))).includes("Rainfed Rice")||a.includes("Irrigated Rice"))&&a.push("Rice"),me.current&&C((function(e){return o})),e.next=27;break;case 24:e.prev=24,e.t1=e.catch(14),F((function(n){return ie({},n,{loading:!1,error:e.t1.message})}));case 27:if(0!==a.length){e.next=30;break}return F((function(e){return ie({},e,{loading:!1,error:"There was an error loading data."})})),e.abrupt("return");case 30:return e.prev=30,e.next=33,(0,s.OP)(D.sel_province.label,l);case 33:u=e.sent,d=[],(p=u.map((function(e){return e.crop})).filter((function(e,n,t){return t.indexOf(e)===n}))).forEach((function(e,n){d.push({id:n,label:e,disabled:!a.includes(e)})})),me.current&&(f=0===p.length?{id:"novalues",label:"No crop types for ".concat(l)}:null,F(ie({},D,{sel_municipality:t,sel_crop:f,sel_stage:[],sel_activity:[],sel_month:null,loading:!1,error:""})),Y((function(e){return d})),M((function(e){return u}))),e.next=43;break;case 40:e.prev=40,e.t2=e.catch(30),F((function(n){return ie({},n,{loading:!1,error:e.t2.message})}));case 43:return e.abrupt("break",60);case 44:return F(ie({},D,{sel_crop:t,sel_stage:[],sel_activity:[],sel_month:null})),b=[],P.filter((function(e){return e.crop===l&&e.province===D.sel_province.label&&e.municipality===D.sel_municipality.label})).forEach((function(e){ne.forEach((function(n){""===e[n.id]||b.includes(n.id)||b.push(n.id)}))})),m=ae(ne),ne.forEach((function(e,n){m[n].disabled=!b.includes(e.id)})),re(m),e.abrupt("break",60);case 51:return h=W[D.sel_province.label][t.id],v=h.label,g=h.val,y=h.format,_=[],j=[],P.forEach((function(e,n){var r=Object.values(x.re).find((function(e){return e.format===t.label})).code;if(""!==e[r]&&e.crop===D.sel_crop.label)for(var i=function(e){l[e].length>0&&!_.includes(l[e])&&(_.push(l[e]),E.filter((function(n){return n.stage===x.MZ[l[e].toUpperCase()]&&("Rice"===D.sel_crop.label?["Irrigated Rice","Rainfed Rice"].includes(n.crop):n.crop===D.sel_crop.label)})).map((function(e){return e.activity})).filter((function(e,n,t){return t.indexOf(e)==n})).length>0&&j.push({id:j.length,label:x.MZ[l[e].toUpperCase()]}))},l=e[r].split(","),a=0;a<l.length;a+=1)i(a)})),Z=E.filter((function(e){return j.map((function(e){return e.label})).includes(e.stage)&&("Rice"===D.sel_crop.label?["Irrigated Rice","Rainfed Rice"].includes(e.crop):e.crop===D.sel_crop.label)})).map((function(e){return{activity:e.activity,stage:e.stage}})).filter((function(e,n,t){return t.map((function(e){return e.activity})).indexOf(e.activity)===n})),O=Z.reduce((function(e,n,t){return e.includes(n.activity)||e.push({id:t,label:n.activity,stage:n.stage}),ae(e)}),[]),F(ie({},D,{sel_month:t,sel_stage:j,sel_activity:O,sel_condition:{id:g,format:y,label:v}})),e.abrupt("break",60);case 59:return e.abrupt("break",60);case 60:e.next=63;break;case 62:"province"===r?_e():"municipality"===r?(F(ie({},D,{sel_municipality:null,sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null})),Y([])):"crop"===r?F(ie({},D,{sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null})):"month"===r&&F(ie({},D,{sel_month:null,sel_stage:[],sel_activity:[]}));case 63:case"end":return e.stop()}}),e,null,[[14,24],[30,40]])})));return function(n,t){return e.apply(this,arguments)}}(),_e=function(){F(ce),B([]),G([]),Y([])},je=function(){var n=te(i().mark((function n(){var t,r,l;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=Object.values(x.re).find((function(e){return e.format===D.sel_month.label})).code;try{r={region:"bicol",province:D.sel_province.label,municipality:D.sel_municipality.label,crop:D.sel_crop.label,month:t,stages:D.sel_stage.map((function(e){return e.label})),activities:D.sel_activity.map((function(e){return e.label})),operation:"create"},he((0,h.Br)(r)).unwrap().then((function(){be!==x.Ry.SEASONAL&&(he((0,b.u)(x.Ry.SEASONAL)),he((0,h.RC)({uid:e.user.uid,type:x.Ry.SEASONAL})))}))}catch(i){l="",void 0!==i.response&&(l=void 0!==i.response.data&&"[object Blob]"===oe(i.response.data)?i.response.data:""),""===l&&(l=i.message)}case 2:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),Ze=function(){var e=te(i().mark((function e(){var n,t,r,l,a,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===$.url){e.next=3;break}return fe(ie({},de,{preview:!0})),e.abrupt("return");case 3:return F((function(e){return ie({},e,{loading:!0,error:"",success:""})})),n=Object.values(x.re).find((function(e){return e.format===D.sel_month.label})).code,e.prev=5,t={region:"bicol",province:D.sel_province.label,municipality:D.sel_municipality.label,crop:D.sel_crop.label,month:n,stages:D.sel_stage.map((function(e){return e.label})),activities:D.sel_activity.map((function(e){return e.label})),operation:"preview"},fe(ie({},de,{preview:!0})),F((function(e){return ie({},e,{loading:!0,error:""})})),e.next=11,(0,p.pl)(t);case 11:r=e.sent,l=new Blob([r],{type:"application/pdf"}),(a={}).href=URL.createObjectURL(l),a.download="".concat(D.sel_province.label,"_").concat(D.sel_municipality.label,"-").concat(D.sel_crop.label,".pdf"),K((function(e){return ie({},e,{url:a.href,filename:a.download})})),F((function(e){return ie({},e,{loading:!1,success:"Bulletin preview created."})})),e.next=26;break;case 20:e.prev=20,e.t0=e.catch(5),o="",void 0!==e.t0.response&&(o=void 0!==e.t0.response.data&&"[object Blob]"===oe(e.t0.response.data)?e.t0.response.data:""),""===o&&(o=e.t0.message),F((function(e){return ie({},e,{loading:!1,error:o})}));case 26:case"end":return e.stop()}}),e,null,[[5,20]])})));return function(){return e.apply(this,arguments)}}();return(0,l.jsx)(Q.Z,{loading:e.loading,user:e.user,onBtnLogoutClick:e.onBtnLogoutClick,accLevel:x.DW.ADMIN,children:(0,l.jsx)(X,{sel_options:D,open:pe,provinces:Z,recommendations:N,optsmunicipalities:V,optscrops:H,optsmonths:ne,pdfPreview:$,onSelectItemChange:ye,handlePreview:Ze,handleSave:je,toggleViewerOpen:function(){fe((function(e){return!e}))},resetSelections:_e,generateRecommendations:function(){if(0!==D.sel_activity.length){var e=E.filter((function(e){return D.sel_activity.map((function(e){return e.label})).includes(e.activity)&&D.sel_stage.map((function(e){return e.label})).includes(e.stage)&&("Rice"===D.sel_crop.label?["Irrigated Rice","Rainfed Rice"].includes(e.crop):e.crop===D.sel_crop.label)})).map((function(e){return{province:e.province,municipality:e.municipality,crop:e.crop,stage:e.stage,activity:e.activity,recommendations:function(){switch(D.sel_condition.label){case x.MW.BELOW_NORMAL.label:case x.MW.NEAR_NORMAL.label:return JSON.parse(e.normal).map((function(e){return{id:t.mains.find((function(n){return n.id===e.id})).description,ul:e.ul,subs:e.subs.map((function(e){return t.subs.find((function(n){return n.id===e})).description}))}}));case x.MW.ABOVE_NORMAL.label:return JSON.parse(e.wetter).map((function(e){return{id:t.mains.find((function(n){return n.id===e.id})).description,ul:e.ul,subs:e.subs.map((function(e){return t.subs.find((function(n){return n.id===e})).description}))}}));case x.MW.WAY_BELOW_NORMAL.label:return JSON.parse(e.drier).map((function(e){return{id:t.mains.find((function(n){return n.id===e.id})).description,ul:e.ul,subs:e.subs.map((function(e){return t.subs.find((function(n){return n.id===e})).description}))}}))}},smsRecommendations:function(){var n="".concat(function(e){var n="";switch(e){case x.MW.WAY_BELOW_NORMAL.label:n="drier";break;case x.MW.BELOW_NORMAL.label:case x.MW.NEAR_NORMAL.label:n="normal";break;case x.MW.ABOVE_NORMAL.label:n="wetter"}return n}(D.sel_condition.label),"_sms");return void 0!==e[n]?t.sms.find((function(t){return t.id===e[n]})).description:""}}}));B(e)}}})})}))}},function(e){e.O(0,[135,203,572,728,448,774,888,179],(function(){return n=108,e(e.s=n);var n}));var n=e.O();_N_E=n}]);