(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[755],{5326:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bulletins/crops/create",function(){return n(6767)}])},7513:function(e,t){"use strict";t.Z={container:{padding:"24px",width:"100%",position:"relative",minWidth:"0px",overflowWrap:"break-word",background:"#FFFFFF",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px",borderRadius:"16px",margin:"auto",borderColor:"#E2E8F0"},welcome:{display:"grid",placeContent:"center",marginTop:function(e){return e.spacing(10)},textAlign:"center","& h5":{marginTop:function(e){return e.spacing(2)}}},conditionLegend:{maxWidth:{md:"100%",lg:"270px"},marginBottom:"32px",padding:function(e){return e.spacing(1)},borderRadius:"4px",border:"1px solid grey",textAlign:"center",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px"},autocomplete:{marginTop:function(e){return e.spacing(1)}},recSeasonal:{marginTop:function(e){return e.spacing(5)},"& p, ul":{fontSize:"14px"}},datagrid:{background:"#FFFFFF",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px",borderRadius:"8px","& .MuiDataGrid-main":{borderRadius:2},"& .MuiDataGrid-virtualScrollerRenderZone":{"& .MuiDataGrid-row":{"&:nth-of-type(2n)":{backgroundColor:"rgba(235, 235, 235, .7)"}}},"& .MuiDataGrid-columnHeader:focus-within":{outline:"none !important"},"& .MuiDataGrid-columnHeaders":{color:function(e){return e.palette.primary.dark},fontSize:16}},gridContainer:{marginTop:"24px",minHeight:500,width:1,"& .normal":{backgroundColor:"yellow"},"& .drier":{backgroundColor:"red"},"& .wetter":{backgroundColor:"blue"}},button:{color:"#FFFFFF",textTransform:"capitalize",fontSize:"14px",fontStyle:"normal",fontWeight:"normal",width:"80px",height:{xs:"40px",sm:"50px"}}}},6767:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSG:function(){return le},default:function(){return se}});var r=n(4051),i=n.n(r),o=n(5893),a=n(7294),c=n(1163),l=n(3835),s=n(2848),u=n(1652),p=n(4680),d=n(560),f=n(8152),h=n(7682),b=n(7426),v=[{label:"Select a province",description:"Select a province within the Bicol region.",opt_name:"sel_province"},{label:"Select a municipality",description:"Select a municipality included in the province you have selected on step no. 1.",opt_name:"sel_municipality"},{label:"Select a crop type",description:"Listed below are available crops for your selected province and municipality.",opt_name:"sel_crop"},{label:"Select a month",description:"Select a target month from the current Seasonal Weather Forecast.",opt_name:"sel_month"},{label:"Select crop stages",description:"Listed below are the available crop stages for your selected crop on the target month.",opt_name:"sel_stage"},{label:"Select activities",description:"Here are available activities for the previously-selected parameters.",opt_name:"sel_activity"}],m=n(1664),g=n(5675),y=n(6295),x=n(7357),_=n(9368),j=n(8456),w=n(1057),S=n(6863),O=n(657),Z=n(1425),R=n(6580),C=n(8951),k=n(7645),P=n(7720),E=n(6886),T=n(5113),B=n(6624),A=n(4472),I=n(3578),F=n(6229),D=n(1903),L=n(5861),M=n(120),N=n(1033);var W=function(e){var t=e.text,n=void 0===t?"":t,r=e.size,i=void 0===r?24:r,a=e.children;return(0,o.jsxs)(x.Z,{sx:{width:"100%",textAlign:"center",height:"20vh"},children:[(0,o.jsxs)(x.Z,{sx:{width:"100%",textAlign:"center",marginTop:function(e){return e.spacing(12)},marginBottom:"32px",display:"flex",justifyContent:"center"},children:[(0,o.jsx)("span",{children:""!==n?n:"Loading..."})," \xa0",(0,o.jsx)(j.Z,{size:i})]}),a]})},z=n(7702),U=n(9794),q=n(9628),G=n(7171),H=n(7513);function V(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){V(e,t,n[t])}))}return e}var J=["sel_province","sel_municipality","sel_crop","sel_month","sel_stage","sel_activity"];var $=function(e){var t=(0,a.useState)(0),n=t[0],r=t[1],i=(0,a.useRef)(!0),l=(0,c.useRouter)(),s=(0,a.useState)(!0),u=s[0],p=s[1],d=e.sel_options,f=e.provinces,h=e.recommendations,v=e.onSelectItemChange,V=e.optsmunicipalities,$=e.optscrops,X=e.optscropstages,Q=e.optsactivities,Y=e.optsmonths,ee=e.open,te=e.pdfPreview,ne=e.steps,re=e.getStepLabel,ie=e.isContinueDisabled,oe=e.handleSave,ae=e.handlePreview,ce=e.toggleViewerOpen,le=(0,o.jsx)(q.Z,{fontSize:"small"}),se=(0,o.jsx)(G.Z,{fontSize:"small"});(0,a.useEffect)((function(){return i.current=!0,function(){i.current=!1}}),[]);var ue=function(){p(!1),setTimeout((function(){(i.current=!0)&&p(!0)}),500),r((function(e){return e+1}))},pe=function(){r((function(e){return e-1}))},de=function(){var e="Loading...";return f.length>0&&(e=null===d.sel_province?"Select a province":"Province"),e};return(0,o.jsxs)(z.Z,{loading:e.loading,user:e.user,onBtnLogoutClick:e.onBtnClick,children:[(0,o.jsxs)(O.Z,{open:ee.savesuccess,"aria-labelledby":"data-saved-success","aria-describedby":"alert-dialog-description",children:[(0,o.jsx)(k.Z,{id:"data-saved-success",children:"Success"}),(0,o.jsx)(R.Z,{children:(0,o.jsx)(C.Z,{id:"alert-dialog-description",children:"Success! Bulletin report created."})}),(0,o.jsx)(Z.Z,{children:(0,o.jsx)(w.Z,{onClick:function(){l.push("/admin/bulletins/crops/view/?docId=".concat(ee.docId))},autoFocus:!0,children:"OK"})})]}),(0,o.jsxs)(O.Z,{open:ee.preview,maxWidth:"lg",fullWidth:!0,"aria-labelledby":"data-saved-success","aria-describedby":"alert-dialog-description",children:[(0,o.jsx)(k.Z,{id:"data-saved-success",children:""!==te.filename?"Bulletin Preview - ".concat(te.filename):"Bulletin Preview"}),(0,o.jsx)(R.Z,{sx:{padding:0,overflow:"hidden"},children:(0,o.jsx)(x.Z,{id:"alert-dialog-description",children:d.loading?(0,o.jsx)("div",{style:{width:"100%",height:"90vh",textAlign:"center"},children:(0,o.jsx)(W,{text:"Loading Preview...",children:(0,o.jsx)(g.default,{unoptimized:!0,src:(0,M.assetPrefixer)("images/icons/data-processing-128.png"),height:100,width:100,loader:M.imageLoader,alt:"Loading Preview"})})}):""!==d.error?(0,o.jsx)("div",{style:{width:"100%",height:"90vh"},children:(0,o.jsx)(N.Z,{message:d.error})}):(0,o.jsx)("embed",{src:te.url,style:{width:"100%",height:"90vh"}})})}),(0,o.jsx)(Z.Z,{children:(0,o.jsx)(w.Z,{variant:"contained",onClick:ce,autoFocus:!0,children:"OK"})})]}),(0,o.jsxs)(E.ZP,{container:!0,sx:H.Z.container,children:[(0,o.jsxs)(x.Z,{sx:{marginBottom:"32px"},children:[(0,o.jsx)(L.Z,{variant:"h5",children:"Create Crop Recommendations Bulletins"}),(0,o.jsxs)("p",{children:["Create ",(0,o.jsx)("strong",{children:"Seasonal"})," crop recommendations bulletins. Finalized bulletins will be automatically uploaded to the site for public download."]})]}),(0,o.jsxs)(E.ZP,{item:!0,sx:H.Z.item,xs:12,lg:4,children:[(0,o.jsxs)(x.Z,{sx:{minWidth:"100%",paddingRight:function(e){return e.spacing(2)}},children:[(0,o.jsx)(L.Z,{variant:"h6",children:"Selection Options"}),(0,o.jsx)(B.Z,{activeStep:n,orientation:"vertical",children:ne.map((function(e,t){return(0,o.jsxs)(A.Z,{children:[(0,o.jsx)(I.Z,{optional:5===t?(0,o.jsx)(L.Z,{variant:"caption",children:"Last step"}):null,children:re(t)}),(0,o.jsxs)(F.Z,{children:[(0,o.jsx)(L.Z,{variant:"subtitle",children:e.description}),0===t&&(0,o.jsx)(y.Z,{disablePortal:!0,id:"province",value:d.sel_province,disabled:0===f.length,options:f,sx:H.Z.autocomplete,renderInput:function(e){return(0,o.jsx)(D.Z,K({},e,{label:de()}))},isOptionEqualToValue:function(e,t){return e.label===t.label},onChange:function(e,t){return v(e,K({},t,{from:"province"}))}}),1===t&&(0,o.jsx)(y.Z,{disablePortal:!0,id:"municipality",value:d.sel_municipality,disabled:0===V.length||d.loading,options:V,sx:H.Z.autocomplete,renderInput:function(e){return(0,o.jsx)(D.Z,K({},e,{label:null===d.sel_municipality?"Select a municipality":"Municipality"}))},isOptionEqualToValue:function(e,t){return e.label===t.label},onChange:function(e,t){return v(e,K({},t,{from:"municipality"}))}}),2===t&&(0,o.jsx)(y.Z,{disablePortal:!0,id:"crop",value:d.sel_crop,disabled:0===$.length,options:$,sx:H.Z.autocomplete,renderInput:function(e){return(0,o.jsx)(D.Z,K({},e,{label:null===d.sel_crop?"Select a crop type":"Crop"}))},isOptionEqualToValue:function(e,t){return e.label===t.label},getOptionDisabled:function(e){return e.disabled},onChange:function(e,t){return v(e,K({},t,{from:"crop"}))}}),3===t&&(0,o.jsx)(y.Z,{disablePortal:!0,id:"month",value:d.sel_month,disabled:0===Y.length||null===d.sel_crop,options:Y,sx:H.Z.autocomplete,renderInput:function(e){return(0,o.jsx)(D.Z,K({},e,{label:null===d.sel_month?"Select a Month":"Month"}))},isOptionEqualToValue:function(e,t){return e.label===t.label},getOptionDisabled:function(e){return e.disabled},onChange:function(e,t){return v(e,K({},t,{from:"month"}))}}),4===t&&(0,o.jsx)(y.Z,{disablePortal:!0,id:"cropstage",multiple:!0,disableCloseOnSelect:!0,limitTags:1,value:d.sel_stage,disabled:0===X.length,options:X,sx:H.Z.autocomplete,renderInput:function(e){return(0,o.jsx)(D.Z,K({},e,{label:0===d.sel_stage.length?"Select crop stages":"Crop Stages"}))},getOptionDisabled:function(e){return e.disabled},onChange:function(e,t){return v(e,K({},t,{from:"cropstage"}))},renderOption:function(e,t,n){var r=n.selected;return(0,o.jsxs)("li",K({},e,{children:[(0,o.jsx)(_.Z,{id:"cropstage",icon:le,checkedIcon:se,style:{marginRight:8},checked:r}),t.label]}))}}),5===t&&(0,o.jsx)(y.Z,{disablePortal:!0,id:"activity",multiple:!0,disableCloseOnSelect:!0,limitTags:1,value:d.sel_activity,disabled:0===Q.length,options:Q.sort((function(e,t){return t.stage.localeCompare(e.stage)})),groupBy:function(e){return e.stage},sx:H.Z.autocomplete,renderInput:function(e){return(0,o.jsx)(D.Z,K({},e,{label:0===d.sel_activity.length?"Select activities":"Activities"}))},getOptionDisabled:function(e){return e.disabled},onChange:function(e,t){return v(e,K({},t,{from:"activity"}))},renderOption:function(e,t,n){var r=n.selected;return(0,o.jsxs)("li",K({},e,{children:[(0,o.jsx)(_.Z,{id:"activity",icon:le,checkedIcon:se,style:{marginRight:8},checked:r}),t.label]}))}}),""!==d.error&&(0,o.jsx)(L.Z,{variant:"caption",sx:{color:"red"},children:d.error}),(0,o.jsx)(x.Z,{sx:{mb:2,marginTop:"24px"},children:(0,o.jsxs)("div",{children:[(0,o.jsx)(w.Z,{variant:"contained",disabled:ie(t)||d.loading||!u,onClick:ue,children:t===ne.length-1?"Finish":"Continue"}),(0,o.jsx)(w.Z,{disabled:d.loading||!u||0===t,onClick:pe,children:"Back"})]})})]})]},e.label)}))}),n===ne.length&&(0,o.jsxs)(T.Z,{square:!0,elevation:0,sx:{p:3},children:[(0,o.jsx)(L.Z,{children:"All steps completed"}),(0,o.jsx)(w.Z,{onClick:function(){r(0),v(null,{from:"province"})},sx:{mt:1,mr:1},children:"Restart"}),(0,o.jsx)(w.Z,{onClick:pe,sx:{mt:1,mr:1},children:"Back"})]})]}),null!==d.sel_month&&(0,o.jsxs)(x.Z,{sx:H.Z.conditionLegend,style:{backgroundColor:b.tN[d.sel_condition.label]},children:[(0,o.jsx)(L.Z,{variant:"subtitle2",children:"Seasonal Weather Condition"}),(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{children:d.sel_month.label})," \xa0",(0,o.jsxs)("span",{children:["".concat(d.sel_condition.label.charAt(0).toUpperCase()).concat(d.sel_condition.label.slice(1))," (",d.sel_condition.id,"%)"]})]})]})]}),(0,o.jsx)(E.ZP,{item:!0,sx:H.Z.item,xs:12,lg:8,children:null!==d.sel_crop&&null!==d.sel_activity&&6===n?(0,o.jsxs)("div",{children:[null!==d.sel_crop&&null!==d.sel_activity&&(0,o.jsxs)("div",{children:[(0,o.jsxs)(L.Z,{variant:"h4",sx:{display:0===d.sel_activity.length?"none":"flex"},children:[d.sel_crop.label," Recommendations"]}),(0,o.jsx)(L.Z,{variant:"h5",children:"".concat(d.sel_condition.label.charAt(0).toUpperCase()).concat(d.sel_condition.label.slice(1)," Condition")})]}),h.length>0?h.map((function(e,t){var n="Rice"===d.sel_crop.label?"(".concat(e.crop,")"):"";return(0,o.jsxs)(x.Z,{sx:H.Z.recSeasonal,children:[(0,o.jsxs)(L.Z,{variant:"h5",children:[e.stage," - ",e.activity," ",n]}),e.recommendations().map((function(e,n){return e.ul?(0,o.jsxs)("ul",{children:[(0,o.jsx)("li",{children:e.id}),e.subs.length>0&&(0,o.jsx)("ul",{children:e.subs.map((function(e,n){return(0,o.jsx)("li",{children:e},"sub-".concat(t,"-").concat(n))}))})]},"main-".concat(t,"-").concat(n)):(0,o.jsx)("p",{children:e.id},"main-".concat(t,"-").concat(n))}))]},"rec-".concat(t))})):(0,o.jsx)(N.Z,{message:"We cannot find recommendations for your selected options."})]}):Object.values(d).filter((function(e){return e})).length>3?(0,o.jsx)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center"},children:J.map((function(e,t){var n=["sel_stage","sel_activity"].includes(e)?d[e].length>0&&"weather_condition"!==d[e].from:null!==d[e]&&void 0!==d[e]&&void 0!==d[e].from&&"weather_condition"!==d[e].from,r=["sel_stage","sel_activity"].includes(e)?{from:{sel_stage:"cropstage",sel_activity:"activity"}[e],label:d[e].map((function(e){return e.label})).toString().split(",").join(", ")}:d[e];return n?(0,o.jsx)(U.Z,{info:r,show:t<J.length-1},"card-opt-".concat(t)):(0,o.jsx)("div",{},"card-opt-".concat(t))}))}):(0,o.jsxs)(x.Z,{sx:H.Z.welcome,children:[(0,o.jsx)(g.default,{unoptimized:!0,src:(0,M.assetPrefixer)("images/icons/finance.svg"),height:120,width:120,loader:M.imageLoader,alt:"Empty data"}),(0,o.jsx)(L.Z,{variant:"h5",children:"Crop Recommendations PDF Bulletins Creator"}),(0,o.jsx)(L.Z,{variant:"p",children:"Please select a province to start."})]})}),(0,o.jsxs)(x.Z,{sx:{marginBottom:"16px",width:"100%",display:6===n?"block":"none"},children:[(0,o.jsx)("br",{}),(0,o.jsx)(P.Z,{}),(0,o.jsx)("br",{}),""!==d.error&&(0,o.jsxs)(L.Z,{variant:"caption",sx:{color:"red"},children:["Error: ",d.error]}),(0,o.jsxs)(S.Z,{size:"large","aria-label":"large button group",sx:{display:"flex",justifyContent:"flex-end",marginTop:"8px"},children:[(0,o.jsx)(m.default,{href:"/admin/bulletins/crops",passHref:!0,children:(0,o.jsx)(w.Z,{disabled:d.loading,children:"Cancel"})}),(0,o.jsxs)(w.Z,{disabled:d.loading,onClick:ae,children:[(0,o.jsx)("span",{style:{display:d.loading?"none":"block"},children:"Preview"})," \xa0",(0,o.jsx)(j.Z,{size:20,color:"secondary",sx:{display:d.loading?"block":"none"}})]}),(0,o.jsx)(w.Z,{variant:"contained",onClick:oe,disableElevation:!0,disabled:d.loading,children:"Save"})]})]})]})]})};function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Q(e,t,n,r,i,o,a){try{var c=e[o](a),l=c.value}catch(s){return void n(s)}c.done?t(l):Promise.resolve(l).then(r,i)}function Y(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){Q(o,r,i,a,c,"next",e)}function c(e){Q(o,r,i,a,c,"throw",e)}a(void 0)}))}}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ee(e,t,n[t])}))}return e}function ne(e){return function(e){if(Array.isArray(e))return X(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return X(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return X(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var re=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};var ie={sel_province:null,sel_municipality:null,sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null,sel_condition:{id:0,from:"weather_condition",label:b.MW.DRIER.label},loading:!1,error:"",success:""},oe={url:"",filename:""},ae={preview:!1,savesuccess:!1,docId:""};function ce(e){var t=e.municipalities,n=void 0===t?[]:t,r=(0,l.aC)(),m=(0,c.useRouter)(),g=(0,h.Kx)(p.o.CROP_REC_LIST_RECS_MAIN,"id"),y=g.documents,x=g.loading,_=(0,h.Kx)(p.o.CROP_REC_LIST_RECS_SUB,"id"),j=_.documents,w=_.loading,S=(0,h.m$)(d.M.WEATHER_FORECASTS,"bicol",d.M.SUB_SEASONAL,"name"),O=S.documents,Z=S.loading,R=(0,a.useState)([]),C=R[0],k=R[1],P=(0,a.useState)([]),E=P[0],T=P[1],B=(0,a.useState)([]),A=B[0],I=B[1],F=(0,a.useState)([]),D=F[0],L=F[1],M=(0,a.useState)([]),N=M[0],W=M[1],z=(0,a.useState)({}),U=z[0],q=z[1],G=(0,a.useState)(ie),H=G[0],V=G[1],K=(0,a.useState)([]),J=K[0],X=K[1],Q=(0,a.useState)([]),ee=Q[0],ce=Q[1],le=(0,a.useState)([]),se=le[0],ue=le[1],pe=(0,a.useState)([]),de=pe[0],fe=pe[1],he=(0,a.useState)(oe),be=he[0],ve=he[1],me=(0,a.useState)([]),ge=me[0],ye=me[1],xe=(0,a.useState)(ae),_e=xe[0],je=xe[1],we=(0,a.useRef)(!1);(0,a.useEffect)((function(){return we.current=!0,function(){we.current=!1}}),[]),(0,a.useEffect)((function(){r.loading||r.user||m.push("/admin/login")}),[r.user,r.loading,m]),(0,a.useEffect)((function(){if(n.length>0&&!x&&!w&&!Z){var e={};O.forEach((function(t){var n=t.name.split("_").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join(" ");e[n]={},t.months.forEach((function(t){e[n][t.mo]={label:t.con,val:t.val}}))}));var t=[];O[0].mos.forEach((function(e){t.push({id:b.re[e.toUpperCase()].code,label:b.re[e.toUpperCase()].format,disabled:!1})}));var r={},i=[];n.forEach((function(e,t){void 0===r[e.province]?(i.push({id:t,label:e.province}),r[e.province]=[{id:0,label:e.name}]):r[e.province].push({id:r[e.province].length,label:e.name})})),we.current&&(T(r),k(i),ye(t),q(e))}}),[n,O,x,w,Z]);var Se=function(){var e=Y(i().mark((function e(t,n){var r,o,a,c,l,p,d,f,h,v,m,g,x,_,w,S,O,Z,R,C,k,P,T,B,F;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.from,o=n.label,t&&t.preventDefault(),W([]),ve(oe),!(["cropstage","activity"].includes(r)?Object.keys(n).length>1:Object.keys(n).includes("id"))){e.next=93;break}e.t0=r,e.next="province"===e.t0?9:"municipality"===e.t0?15:"crop"===e.t0?48:"month"===e.t0?57:"cropstage"===e.t0?67:"activity"===e.t0?77:90;break;case 9:return V(te({},H,{sel_province:n,sel_municipality:null,sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null})),X(E[o]),ce([]),ue([]),fe([]),e.abrupt("break",91);case 15:return ue([]),fe([]),a=[],e.prev=18,V(te({},H,{loading:!0,error:""})),e.next=22,(0,u.$K)(H.sel_province.label,o);case 22:c=e.sent,((a=c.map((function(e){return e.crop})).filter((function(e,t,n){return n.indexOf(e)===t}))).includes("Rainfed Rice")||a.includes("Irrigated Rice"))&&a.push("Rice"),we.current&&I((function(e){return c})),e.next=31;break;case 28:e.prev=28,e.t1=e.catch(18),V((function(t){return te({},t,{loading:!1,error:e.t1.message})}));case 31:if(0!==a.length){e.next=34;break}return V((function(e){return te({},e,{loading:!1,error:"There was an error loading data."})})),e.abrupt("return");case 34:return e.prev=34,e.next=37,(0,s.OP)(H.sel_province.label,o);case 37:l=e.sent,p=[],(d=l.map((function(e){return e.crop})).filter((function(e,t,n){return n.indexOf(e)===t}))).forEach((function(e,t){p.push({id:t,label:e,disabled:!a.includes(e)})})),we.current&&(f=0===d.length?{id:"novalues",label:"No crop types for ".concat(o)}:null,V(te({},H,{sel_municipality:n,sel_crop:f,sel_stage:[],sel_activity:[],sel_month:null,loading:!1,error:""})),ue(p),ce((function(e){return p})),L((function(e){return l}))),e.next=47;break;case 44:e.prev=44,e.t2=e.catch(34),V((function(t){return te({},t,{loading:!1,error:e.t2.message})}));case 47:return e.abrupt("break",91);case 48:return ue([]),fe([]),V(te({},H,{sel_crop:n,sel_stage:[],sel_activity:[],sel_month:null})),h=[],D.filter((function(e){return e.crop===o&&e.province===H.sel_province.label&&e.municipality===H.sel_municipality.label})).forEach((function(e){ge.forEach((function(t){""===e[t.id]||h.includes(t.id)||h.push(t.id)}))})),v=ne(ge),ge.forEach((function(e,t){v[t].disabled=!h.includes(e.id)})),ye(v),e.abrupt("break",91);case 57:return m=U[H.sel_province.label][n.id].label,g=U[H.sel_province.label][n.id].val,fe([]),x=[],_=[],D.forEach((function(e,t){var r=Object.values(b.re).find((function(e){return e.format===n.label})).code;if(""!==e[r]&&e.crop===H.sel_crop.label)for(var i=function(e){if(o[e].length>0&&!x.includes(o[e])){x.push(o[e]);var t=A.filter((function(t){return t.stage===b.MZ[o[e].toUpperCase()]&&("Rice"===H.sel_crop.label?["Irrigated Rice","Rainfed Rice"].includes(t.crop):t.crop===H.sel_crop.label)})).map((function(e){return e.activity})).filter((function(e,t,n){return n.indexOf(e)==t}));_.push({id:_.length,label:b.MZ[o[e].toUpperCase()],disabled:0===t.length})}},o=e[r].split(","),a=0;a<o.length;a+=1)i(a)})),w=0===_.length?[{id:"novalues",label:"No crop stage for ".concat(o)}]:[],ue(_),V(te({},H,{sel_month:n,sel_stage:w,sel_activity:[],sel_condition:{label:m,id:g}})),e.abrupt("break",91);case 67:for(O in S=[],n)"from"!==O&&S.push(n[O]);return Z=[],R=A.filter((function(e){return S.map((function(e){return e.label})).includes(e.stage)&&("Rice"===H.sel_crop.label?["Irrigated Rice","Rainfed Rice"].includes(e.crop):e.crop===H.sel_crop.label)})).map((function(e){return{activity:e.activity,stage:e.stage}})).filter((function(e,t,n){return n.map((function(e){return e.activity})).indexOf(e.activity)===t})),C=0===R.length?[{id:"novalues",label:"No activities for selected options"}]:[],V(te({},H,{sel_stage:ne(S),sel_activity:ne(C)})),k=[],R.forEach((function(e,t){k.includes(e.activity)||(Z.push({id:t,label:e.activity,stage:e.stage}),k.push(e.activity))})),fe((function(e){return Z})),e.abrupt("break",91);case 77:e.t3=regeneratorRuntime.keys(H);case 78:if((e.t4=e.t3()).done){e.next=84;break}if(P=e.t4.value,null!==H[P]||"sel_activity"===P){e.next=82;break}return e.abrupt("return");case 82:e.next=78;break;case 84:for(B in T=[],n)"from"!==B&&T.push(n[B]);return F=A.filter((function(e){return T.map((function(e){return e.label})).includes(e.activity)&&H.sel_stage.map((function(e){return e.label})).includes(e.stage)&&("Rice"===H.sel_crop.label?["Irrigated Rice","Rainfed Rice"].includes(e.crop):e.crop===H.sel_crop.label)})).map((function(e){return{province:e.province,municipality:e.municipality,crop:e.crop,stage:e.stage,activity:e.activity,recommendations:function(){switch(H.sel_condition.label){case b.MW.NORMAL.label:return JSON.parse(e.normal).map((function(e){return{id:y.find((function(t){return t.id===e.id})).description,ul:e.ul,subs:e.subs.map((function(e){return j.find((function(t){return t.id===e})).description}))}}));case b.MW.WETTER.label:return JSON.parse(e.wetter).map((function(e){return{id:y.find((function(t){return t.id===e.id})).description,ul:e.ul,subs:e.subs.map((function(e){return j.find((function(t){return t.id===e})).description}))}}));case b.MW.DRIER.label:return JSON.parse(e.drier).map((function(e){return{id:y.find((function(t){return t.id===e.id})).description,ul:e.ul,subs:e.subs.map((function(e){return j.find((function(t){return t.id===e})).description}))}}))}}}})),V(te({},H,{sel_activity:ne(T)})),W(F),e.abrupt("break",91);case 90:return e.abrupt("break",91);case 91:e.next=94;break;case 93:"province"===r?(V(ie),X([]),ce([]),ue([]),fe([])):"municipality"===r?(V(te({},H,{sel_municipality:null,sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null})),ce([]),ue([]),fe([])):"crop"===r?(V(te({},H,{sel_crop:null,sel_stage:[],sel_activity:[],sel_month:null})),ue([]),fe([])):"month"===r?(V(te({},H,{sel_month:null,sel_stage:[],sel_activity:[]})),ue([]),fe([])):"cropstage"===r?(V(te({},H,{sel_stage:[],sel_activity:[]})),fe([])):"activity"===r&&V(te({},H,{sel_activity:[]}));case 94:case"end":return e.stop()}}),e,null,[[18,28],[34,44]])})));return function(t,n){return e.apply(this,arguments)}}(),Oe=function(){var e=Y(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.logOut();case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(){return e.apply(this,arguments)}}(),Ze=function(){var e=Y(i().mark((function e(){var t,n,r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V((function(e){return te({},e,{loading:!0,error:"",success:""})})),t=Object.values(b.re).find((function(e){return e.format===H.sel_month.label})).code,e.prev=2,n={region:"bicol",province:H.sel_province.label,municipality:H.sel_municipality.label,crop:H.sel_crop.label,month:t,stages:H.sel_stage.map((function(e){return e.label})),activities:H.sel_activity.map((function(e){return e.label})),operation:"create"},V((function(e){return te({},e,{loading:!0,error:""})})),e.next=7,(0,f.Zn)(n);case 7:r=e.sent,V((function(e){return te({},e,{loading:!1,success:"Bulletin report created."})})),je(te({},ae,{savesuccess:!0,docId:r.id})),e.next=18;break;case 12:e.prev=12,e.t0=e.catch(2),o="",void 0!==e.t0.response&&(o=void 0!==e.t0.response.data&&"[object Blob]"===re(e.t0.response.data)?e.t0.response.data:""),""===o&&(o=e.t0.message),V((function(e){return te({},e,{loading:!1,error:o})}));case 18:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(){return e.apply(this,arguments)}}(),Re=function(){var e=Y(i().mark((function e(){var t,n,r,o,a,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===be.url){e.next=3;break}return je(te({},ae,{preview:!0})),e.abrupt("return");case 3:return V((function(e){return te({},e,{loading:!0,error:"",success:""})})),t=Object.values(b.re).find((function(e){return e.format===H.sel_month.label})).code,e.prev=5,n={region:"bicol",province:H.sel_province.label,municipality:H.sel_municipality.label,crop:H.sel_crop.label,month:t,stages:H.sel_stage.map((function(e){return e.label})),activities:H.sel_activity.map((function(e){return e.label})),operation:"preview"},je(te({},ae,{preview:!0})),V((function(e){return te({},e,{loading:!0,error:""})})),e.next=11,(0,f.pl)(n);case 11:r=e.sent,o=new Blob([r],{type:"application/pdf"}),(a={}).href=URL.createObjectURL(o),a.download="".concat(H.sel_province.label,"_").concat(H.sel_municipality.label,"-").concat(H.sel_crop.label,".pdf"),ve((function(e){return te({},e,{url:a.href,filename:a.download})})),V((function(e){return te({},e,{loading:!1,success:"Bulletin preview created."})})),e.next=27;break;case 20:e.prev=20,e.t0=e.catch(5),c="",void 0!==e.t0.response&&(c=void 0!==e.t0.response.data&&"[object Blob]"===re(e.t0.response.data)?e.t0.response.data:""),""===c&&(c=e.t0.message),c+="\n---heeeere!",V((function(e){return te({},e,{loading:!1,error:c})}));case 27:case"end":return e.stop()}}),e,null,[[5,20]])})));return function(){return e.apply(this,arguments)}}();return(0,o.jsx)($,{loading:r.loading,user:r.user,onBtnClick:Oe,sel_options:H,open:_e,provinces:C,recommendations:N,optsmunicipalities:J,optscrops:ee,optscropstages:se,optsactivities:de,optsmonths:ge,pdfPreview:be,steps:v,conditions:[{id:"norm",label:"Normal Conditions"},{id:"wet",label:"Wetter than Normal Conditions"},{id:"dry",label:"Drier than Normal Conditions"}],onSelectItemChange:Se,getStepLabel:function(e){var t=v[e].opt_name,n=["sel_stage","sel_activity"],r=n.includes(t)?0===H[t].length?v[e].label:"".concat(v[e].label,": ").concat(H[t].map((function(e){return e.label})).toString()):null===H[t]?v[e].label:"".concat(v[e].label,": ").concat(H[t].label);return n.includes(t)?0===H[t].length?v[e].label:r:null!==H[t]&&"novalues"===H[t].id?v[e].label:r},isContinueDisabled:function(e){switch(e){case 0:return null===H.sel_province;case 1:return null===H.sel_municipality;case 2:return null===H.sel_crop||"novalues"===H.sel_crop.id;case 3:return null===H.sel_month;case 4:return 0===H.sel_stage.length;case 5:return 0===H.sel_activity.length;default:return!1}},handlePreview:Re,handleSave:Ze,toggleViewerOpen:function(){je((function(e){return!e}))}})}ce.customLayout=!0,ce.adminPage=!0;var le=!0,se=ce},8152:function(e,t,n){"use strict";n.d(t,{Zn:function(){return F},GR:function(){return D},fL:function(){return M},pr:function(){return N},pl:function(){return L}});var r=n(4051),i=n.n(r),o=n(9669),a=n.n(o),c=n(9431);function l(e,t,n,r,i,o,a){try{var c=e[o](a),l=c.value}catch(s){return void n(s)}c.done?t(l):Promise.resolve(l).then(r,i)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){l(o,r,i,a,c,"next",e)}function c(e){l(o,r,i,a,c,"throw",e)}a(void 0)}))}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){d(e,t,n[t])}))}return e}function b(e,t){return!t||"object"!==m(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e,t){return v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},v(e,t)}var m=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var i=f(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}var y={BASE_API_URL:"https://amia-cis.herokuapp.com/api",CREATE_REPORT:"".concat("https://amia-cis.herokuapp.com/api","/reports/seasonal/crops"),REPORTS_CROPS:"reports_crops"},x=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(c,e);var t,n,r,o=g(c);function c(){return u(this,c),o.apply(this,arguments)}return t=c,(n=[{key:"createReport",value:function(e){var t=this;return s(i().mark((function n(){var r,o;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.createRequestObject({body:e});case 2:return r=n.sent,n.next=5,a()(h({},r,{url:y.CREATE_REPORT,method:"POST"}));case 5:return o=n.sent,n.abrupt("return",o.data);case 7:case"end":return n.stop()}}),n)})))()}},{key:"deleteReport",value:function(e){var t=this;return s(i().mark((function n(){var r,o;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={docId:e},n.next=3,t.createRequestObject({body:r});case 3:return o=n.sent,n.next=6,a()(h({},o,{url:y.CREATE_REPORT,method:"DELETE"}));case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}}),n)})))()}},{key:"previewBulletin",value:function(e){var t=this;return s(i().mark((function n(){var r,o;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.createRequestObject({body:e,responseType:"blob"});case 2:return r=n.sent,n.next=5,a()(h({},r,{url:y.CREATE_REPORT,method:"POST"}));case 5:return o=n.sent,n.abrupt("return",o.data);case 7:case"end":return n.stop()}}),n)})))()}}])&&p(t.prototype,n),r&&p(t,r),c}(c.Z),_=n(4763);function j(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e,t,n,r,i,o,a){try{var c=e[o](a),l=c.value}catch(s){return void n(s)}c.done?t(l):Promise.resolve(l).then(r,i)}function S(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){w(o,r,i,a,c,"next",e)}function c(e){w(o,r,i,a,c,"throw",e)}a(void 0)}))}}function O(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(e){return R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},R(e)}function C(e,t){return!t||"object"!==P(t)&&"function"!==typeof t?j(e):t}function k(e,t){return k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},k(e,t)}var P=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function E(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=R(e);if(t){var i=R(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return C(this,n)}}var T="reports_crops",B=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(n,e);var t=E(n);function n(){var e;O(this,n);var r=j(e=t.apply(this,arguments));Z(j(e),"getBulletin",function(){var e=S(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getDocumentData(T,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var o=j(e);return Z(j(e),"getBulletins",function(){var e=S(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.collection(o.db,T),r=o.query(n,o.where("uid","==",t)),e.next=4,o.getCollectionData(T,"",r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e}return n}(_.Z),A=new x,I=new B,F=A.createReport.bind(A),D=A.deleteReport.bind(A),L=A.previewBulletin.bind(A),M=I.getBulletin.bind(I),N=I.getBulletins.bind(I)}},function(e){e.O(0,[611,669,203,27,771,899,974,774,888,179],(function(){return t=5326,e(e.s=t);var t}));var t=e.O();_N_E=t}]);